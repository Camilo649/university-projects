(function(g){var window=this;'use strict';var V0H=function(l){var y=new g.Ty("und",new g.uM("Default","und",!0));y.captionTracks=l.captionTracks;return y},CAj=function(l){return new g.sV(function(y,r){var c=l.length,O=[];
if(c)for(var H=function(N,S){c--;O[N]=S;c==0&&y(O)},V=function(N){r(N)},T,f=0;f<l.length;f++)T=l[f],g.xf3(T,g.Ll(H,f),V);
else y(O)})},dS=function(l){this.G=l},iP=function(){dS.apply(this,arguments)},gUs=function(){iP.apply(this,arguments)},T9I=function(){iP.apply(this,arguments)},f1J=function(){iP.apply(this,arguments)},N9g=function(){iP.apply(this,arguments)},SGJ=function(){iP.apply(this,arguments)},F6Q=function(){iP.apply(this,arguments)},pXs=function(){dS.apply(this,arguments)},EUJ=function(){iP.apply(this,arguments)},uKg=function(){iP.apply(this,arguments)},M0J=function(){iP.apply(this,arguments)},a1H=function(){iP.apply(this,
arguments)},spH=function(){iP.apply(this,arguments)},K6Q=function(){iP.apply(this,arguments)},I1g=function(){iP.apply(this,arguments)},YGB=function(){iP.apply(this,arguments)},qGH=function(){iP.apply(this,arguments)},Anz=function(){iP.apply(this,arguments)},W6p=function(){iP.apply(this,arguments)},mSb=function(){iP.apply(this,arguments)},vUJ=function(){dS.apply(this,arguments)},JnJ=function(){iP.apply(this,arguments)},oUz=function(){iP.apply(this,arguments)},h7B=function(){iP.apply(this,arguments)},
G$z=function(){iP.apply(this,arguments)},Ztx=function(){iP.apply(this,arguments)},$Sg=function(){iP.apply(this,arguments)},B9j=function(){iP.apply(this,arguments)},t0J=function(){iP.apply(this,arguments)},DSb=function(){iP.apply(this,arguments)},dSp=function(){dS.apply(this,arguments)},itj=function(){dS.apply(this,arguments)},XXQ=function(){dS.apply(this,arguments)},QpH=function(){iP.apply(this,arguments)},wXJ=function(){iP.apply(this,arguments)},PAJ=function(){iP.apply(this,arguments)},xSH=function(){iP.apply(this,
arguments)},e7j=function(){iP.apply(this,arguments)},nUI=function(){iP.apply(this,arguments)},btJ=function(){iP.apply(this,arguments)},R7H=function(){iP.apply(this,arguments)},USQ=function(){iP.apply(this,arguments)},z7H=function(){iP.apply(this,arguments)},k$j=function(){iP.apply(this,arguments)},jpg=function(){iP.apply(this,arguments)},L6J=function(){iP.apply(this,arguments)},lrB=function(){iP.apply(this,arguments)},yNH=function(){iP.apply(this,arguments)},rNj=function(){iP.apply(this,arguments)},
cNj=function(){iP.apply(this,arguments)},ObJ=function(){iP.apply(this,arguments)},HbJ=function(){iP.apply(this,arguments)},VNx=function(){iP.apply(this,arguments)},C9j=function(){iP.apply(this,arguments)},gZs=function(){iP.apply(this,arguments)},TiB=function(){iP.apply(this,arguments)},frg=function(){iP.apply(this,arguments)},NiJ=function(){iP.apply(this,arguments)},SKg=function(){iP.apply(this,arguments)},FYg=function(){dS.apply(this,arguments)},puz=function(){iP.apply(this,arguments)},EZz=function(){iP.apply(this,
arguments)},ugJ=function(){iP.apply(this,arguments)},MNb=function(){iP.apply(this,arguments)},arj=function(){iP.apply(this,arguments)},sJQ=function(){iP.apply(this,arguments)},KYj=function(){iP.apply(this,arguments)},Irj=function(){iP.apply(this,arguments)},YKz=function(){iP.apply(this,arguments)},qKI=function(){iP.apply(this,arguments)},ANg=function(){iP.apply(this,arguments)},WYQ=function(){iP.apply(this,arguments)},m4x=function(){iP.apply(this,arguments)},vZJ=function(){iP.apply(this,arguments)},
JNj=function(){iP.apply(this,arguments)},oZQ=function(){iP.apply(this,arguments)},hLx=function(){iP.apply(this,arguments)},GOj=function(){iP.apply(this,arguments)},ZbQ=function(){iP.apply(this,arguments)},$4b=function(){iP.apply(this,arguments)},Bis=function(){iP.apply(this,arguments)},tNz=function(){iP.apply(this,arguments)},D4g=function(){iP.apply(this,arguments)},d4Q=function(){iP.apply(this,arguments)},ibH=function(){iP.apply(this,arguments)},Xuz=function(){iP.apply(this,arguments)},QJI=function(){iP.apply(this,
arguments)},wuj=function(){iP.apply(this,arguments)},P9H=function(){iP.apply(this,arguments)},x4z=function(){iP.apply(this,arguments)},eLQ=function(){iP.apply(this,arguments)},nZQ=function(){iP.apply(this,arguments)},bbx=function(l){l=l.key||l.id;
if(!l)throw Error("Entity key is missing");return l},RLp=function(){if(Xy)return Xy();
var l={};Xy=g.Vi("PersistentEntityStoreDb",{Sf:(l.EntityStore={fD:1},l.EntityAssociationStore={fD:2},l),shared:!1,upgrade:function(y,r){r(1)&&g.wX(g.t3(y,"EntityStore",{keyPath:"key"}),"entityType","entityType");r(2)&&(y=g.t3(y,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.wX(y,"byParentEntityKey","parentEntityKey"),g.wX(y,"byChildEntityKey","childEntityKey"))},
version:3});return Xy()},U4j=function(l){return g.zi(RLp(),l)},zLx=function(l){return g.zi((0,g.iYx)(),l)},Qq=function(l){this.token=l},wS=function(l,y){y=y===void 0?{}:y;
g.Lr.call(this,g.Xrg[l],Object.assign({},{name:"PESEncoderError",type:l},y));this.type=l;this.level="WARNING";Object.setPrototypeOf(this,wS.prototype)},kOb=function(l){return new wS("WRONG_DATA_TYPE",{YB:l})},jJx=function(l){return l instanceof Error?new wS("UNKNOWN_ENCODE_ERROR",{s8:l.message}):new wS("UNKNOWN_ENCODE_ERROR")},LYB=function(l){return l instanceof Error?new wS("UNKNOWN_DECODE_ERROR",{s8:l.message}):new wS("UNKNOWN_DECODE_ERROR")},lEj=function(l,y){l=l instanceof wS?l:y(l);
g.wV(l);throw l;},yHs=function(){},rHg=function(l,y,r){try{return l.N(y,r)}catch(c){lEj(c,jJx)}},cHz=function(l){l=(new TextEncoder).encode(l).subarray(0,16);
var y=new Uint8Array(16);y.set(l);return y},Pe=function(l){this.G=l},Hdj=function(l){var y=OdJ[l];
if(y)return y;g.Pv(new g.Lr("Entity model not found.",{entityType:l}))},Vsg=function(l,y){this.G=l;
this.K=y;this.N={}},gip=function(l,y){a:{l=CJg(l.K,y.version);
try{var r=l.K(y.data,y.key);break a}catch(c){lEj(c,LYB)}r=void 0}return r},xp=function(l,y,r){return l.G.objectStore("EntityStore").get(y).then(function(c){if(c){if(r&&c.entityType!==r)throw Error("Incorrect entity type");
return gip(l,c)}})},eQ=function(l,y,r){return r?(r=r.map(function(c){return xp(l,c,y)}),g.o$.all(r)):l.G.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(y)).then(function(c){return c.map(function(O){return gip(l,O)})})},bP=function(l,y,r){var c=bbx(y),O=CJg(l.K,1),H=Object.assign({},y);
return l.G.objectStore("EntityStore").get(c).then(function(V){if(V){if(V.entityType!==r)throw Error("Incorrect entity type");H.entityMetadata||(V=gip(l,V),H.entityMetadata=V.entityMetadata)}}).then(function(){var V={key:c,
entityType:r,data:rHg(O,H,c),version:1};return g.o$.all([g.iz(l.G.objectStore("EntityStore"),V),T_g(l,H,r)])}).then(function(){nB(l,c,r);
return c})},fEJ=function(l,y,r){y=y.map(function(c){return bP(l,c,r)});
return g.o$.all(y)},Ra=function(l,y,r){if(r==null?0:r.Do){var c=new Set;
return N_Q(l,y,c).then(function(){for(var H=[],V=g.a(c),T=V.next();!T.done;T=V.next())H.push(Ra(l,T.value));return g.o$.all(H).then(function(){})})}var O=g.EX(y).entityType;
return g.o$.all([l.G.objectStore("EntityStore").delete(y),STs(l,y)]).then(function(){nB(l,y,O)})},FKg=function(l,y){return g.ns(l.G.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(y)},function(r){return g.o$.all([r.delete(),
STs(l,r.cursor.primaryKey)]).then(function(){nB(l,r.cursor.primaryKey,y);return g.x$(r)})})},pfg=function(l,y,r,c){var O=CJg(l.K,1);
return xp(l,y,c).then(function(H){if(H){H=g.WC(H,r);var V={key:y,entityType:c,data:rHg(O,H,y),version:1};return g.o$.all([g.iz(l.G.objectStore("EntityStore"),V),T_g(l,H,c)])}}).then(function(){nB(l,y,c);
return y})},nB=function(l,y,r){var c=l.N[r];
c||(c=new Set,l.N[r]=c);c.add(y)},Eix=function(l,y,r){var c=bbx(y);
r=Hdj(r);if(!r)return g.o$.resolve([]);r=new r(y);l=l.G.objectStore("EntityAssociationStore");y=[];r=g.a(r.K());for(var O=r.next();!O.done;O=r.next())y.push(g.iz(l,{parentEntityKey:c,childEntityKey:O.value}));return g.o$.all(y).then(function(H){return H.map(function(V){return V[1]})})},STs=function(l,y){return l.G.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(y))},T_g=function(l,y,r){var c=bbx(y);
return STs(l,c).then(function(){return Eix(l,y,r)})},N_Q=function(l,y,r){if(r.has(y))return g.o$.resolve(void 0);
r.add(y);return upB(l,y).then(function(c){return l.G.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(y)).then(function(){return c})}).then(function(c){var O=g.o$.resolve(void 0);
c=g.a(c);for(var H=c.next(),V={};!H.done;V={dR:void 0},H=c.next())V.dR=H.value,O=O.then(function(T){return function(){return N_Q(l,T.dR,r)}}(V));
return O}).then(function(){})},upB=function(l,y){var r=l.G.objectStore("EntityAssociationStore");
return r.index("byParentEntityKey").getAll(IDBKeyRange.only(y)).then(function(c){var O=[];c=g.a(c);for(var H=c.next();!H.done;H=c.next())H=H.value,O.push(r.index("byChildEntityKey").getAll(H.childEntityKey));return g.o$.all(O)}).then(function(c){var O=[];
c=g.a(c);for(var H=c.next();!H.done;H=c.next())H=H.value,H.length===1&&O.push(H[0].childEntityKey);return O})},UW=function(){},Msg=function(){this.G={};
this.G[0]=new UW;if(!g.W0("aes_pes_encoder_killswitch")){var l=this.G;try{var y=g.lz();var r=cHz(y);var c=new Pe(new g.ZT(r),new g.Gl(r))}catch(O){throw l=O instanceof Error?new wS("KEY_CREATION_FAILED",{s8:O.message}):new wS("KEY_CREATION_FAILED"),g.wV(l),l;}l[1]=c}},CJg=function(l,y){y=y===void 0?0:y;
l=l.G[y];if(!l)throw y=new wS("INVALID_ENCODER_VERSION",{YB:y}),g.wV(y),y;return l},zt=function(l,y){g.X.call(this);
this.token=l;this.G=y;this.observers=[];l=new g.QN.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.lz());l.onmessage=this.K.bind(this);this.channel=l},kp=function(l,y,r){var c,O,H,V;
return g.Z(function(T){if(T.G==1)return g.h(T,U4j(l.token),2);if(T.G!=3)return c=T.K,g.h(T,g.dX(c,["EntityStore","EntityAssociationStore"],y,function(f){O=new Vsg(f,l.G);return r(O)}),3);
H=T.K;O&&(V=O.N,Object.keys(V).length>0&&(l.channel.postMessage(V),aEI(l,V)));return T.return(H)})},jQ=function(l,y,r){return kp(l,{mode:"readwrite",
L$:!0},function(c){return bP(c,y,r)})},sAJ=function(l,y){return kp(l,{mode:"readwrite",
L$:!0},function(r){return fEJ(r,y,"offlineOrchestrationActionWrapperEntity")})},KKp=function(l,y){return kp(l,{mode:"readwrite",
L$:!0},function(r){return Ra(r,y)})},IEJ=function(l){return kp(l,{mode:"readwrite",
L$:!0},function(y){return FKg(y,"videoPlaybackPositionEntity")})},LB=function(l,y,r){return kp(l,{mode:"readonly",
L$:!0},function(c){return xp(c,y,r)})},lL=function(l,y,r){return kp(l,{mode:"readonly",
L$:!0},function(c){return eQ(c,y,r)})},aEI=function(l,y){l=g.a(l.observers);
for(var r=l.next();!r.done;r=l.next())r=r.value,r(y)},YTH=function(){var l,y,r;
return g.Z(function(c){if(c.G==1)return g.Im(c,2),g.h(c,g.Oo(),4);if(c.G!=2){l=c.K;if(!l||!g.yF()||typeof g.QN.BroadcastChannel==="undefined")return c.return();y=new Msg;return c.return(new zt(l,y))}r=g.AW(c);r instanceof Error&&g.wV(r);return c.return()})},yS=function(){qTJ||(qTJ=YTH());
return qTJ},AHJ=function(l){var y;
l=(y=l.options)==null?void 0:y.persistenceOption;return l==="ENTITY_PERSISTENCE_OPTION_PERSIST"||l==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},WKI=function(l){var y;
return g.Z(function(r){return r.G==1?g.h(r,yS(),2):(y=r.K)?g.h(r,kp(y,"readwrite",function(c){for(var O={},H=g.a(l),V=H.next(),T={};!V.done;T={Fx:void 0,xW:void 0},V=H.next())T.Fx=V.value,T.Fx.entityKey&&AHJ(T.Fx)&&(T.xW=g.W5(T.Fx.payload),V=void 0,T.Fx.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(V=function(f){return function(){return bP(c,f.Fx.payload[f.xW],f.xW)}}(T)),T.Fx.type==="ENTITY_MUTATION_TYPE_DELETE"&&(V=function(f){return function(){return Ra(c,f.Fx.entityKey)}}(T)),T.Fx.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(V=function(f){return function(){return pfg(c,f.Fx.entityKey,f.Fx.payload[f.xW],f.xW)}}(T)),V&&(O[T.Fx.entityKey]=O[T.Fx.entityKey]?O[T.Fx.entityKey].then(V):V()));
return g.o$.all(Object.values(O))}),0):r.return()})},m0J=function(l){var y;
return g.Z(function(r){if(r.G==1){y=l.mutations;if(!y||y.length<=0)return r.return();if(g.Tc){var c={type:"ENTITY_LOADED"};y!==void 0&&(c.payload=y);g.Tc.dispatch(c)}return g.h(r,WKI(y),2)}y.length=0;g.Kl(r)})},vis=function(l){return l!==void 0},JHs=function(l){var y=g.Ds();
y=Object.assign({},y);l=Object.assign({},l);for(var r in y)l[r]?(y[r]!==4&&(y[r]=l[r]),delete l[r]):y[r]!==2&&(y[r]=4);Object.assign(y,l);g.k5z(y);JSON.stringify(y);return y},oij=function(l){var y,r;
return g.Z(function(c){if(c.G==1)return g.h(c,g.Oo(),2);if(c.G!=3)return(y=c.K)?g.h(c,g.Xl(y),3):c.return();r=c.K;return c.return(g.dX(r,["index","media","captions"],{mode:"readwrite",L$:!0},function(O){var H=IDBKeyRange.bound(l+"|",l+"~");O=[O.objectStore("index").delete(H),O.objectStore("media").delete(H),O.objectStore("captions").delete(H)];return g.o$.all(O).then(function(){})}))})},hNp=function(){var l,y;
return g.Z(function(r){if(r.G==1)return g.h(r,g.Oo(),2);if(r.G!=3){l=r.K;if(!l)throw g.vj("rvdfd");return g.h(r,g.Xl(l),3)}y=r.K;return r.return(g.dX(y,["index","media"],{mode:"readwrite",L$:!0},function(c){var O={};return g.Pj(c.objectStore("index"),{},function(H){var V=H.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),T=g.o$.resolve(void 0);if(V){var f=V[1];V=V[2];O[f]=O[f]||{};var N;O[f][V]=g.r7v((N=H.getValue())==null?void 0:N.fmts)}else T=H.delete().then(function(){});
return g.o$.all([g.x$(H),T]).then(function(S){return g.a(S).next().value})}).then(function(){for(var H={},V=g.a(Object.keys(O)),T=V.next();!T.done;T=V.next()){T=T.value;
var f=O[T].v;H[T]=O[T].a&&f?1:2}var N=JHs(H);return g.GHl(c.objectStore("media"),{},function(S){var F=S.cursor.key.match(g.Vml);F&&H[F[1]]||c.objectStore("media").delete(S.cursor.key);return g.Yrd(S)}).then(function(){return N})})}))})},Gmz=function(l,y){var r,c;
return g.Z(function(O){if(O.G==1)return g.h(O,g.Oo(),2);if(O.G!=3){r=O.K;if(!r)throw g.vj("wct");return g.h(O,g.Xl(r),3)}c=O.K;return g.h(O,g.dX(c,["captions"],{mode:"readwrite",L$:!0},function(H){var V=[];H=H.objectStore("captions");for(var T=0;T<y.length;T++){var f=g.iz(H,y[T],l+"|"+y[T].metadata.vss_id);V.push(f)}return g.o$.all(V)}),0)})},Zds=function(l){var y,r,c;
return g.Z(function(O){if(O.G==1)return y=IDBKeyRange.bound(l+"|",l+"~"),g.h(O,g.Oo(),2);if(O.G!=3){r=O.K;if(!r)throw g.vj("gactfv");return g.h(O,g.Xl(r),3)}c=O.K;return O.return(c.getAll("captions",y))})},$0j=function(l){return g.Z(function(y){g.i1(l,0);
return y.return(oij(l))})},B_g=function(l){return{context:g.Vo(),
videoIds:l}},tsJ=function(l){return{context:g.Vo(),
playlistIds:l}},D0s=function(l){return{context:g.Vo(),
offlinePlaylistSyncChecks:l}},d0j=function(){this.G=new Map},XfJ=function(){idp||(idp=new d0j);
return idp},QAH=function(l,y){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:l},metadata:y,statusCode:void 0,csn:void 0,can:void 0}},wfB=function(l,y,r){if(!r){var c=c===void 0?!1:c;
r=l.G.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!r||c)r=g.o1(16),l.G.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",r)}l={flowNonce:r,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:y.eventType};y.metadata&&(l.flowMetadata=y.metadata);y.statusCode!==void 0&&(l.flowEventStatus=y.statusCode);y.csn&&(l.csn=y.csn);y.can&&(l.can=y.can);g.EE("flowEvent",l,void 0)},PJJ=function(l){var y,r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl,ls,x,L,K,e,Xv,Ig,FQ,vz,jC,Hx,uj,A,m,J;
return g.Z(function(B){if(B.G==1)return g.h(B,kp(l,{mode:"readonly",L$:!0},function(d){return eQ(d,"playbackData").then(function(yN){var Hz=yN.map(function(MJ){return MJ.transfer}).filter(function(MJ){return!!MJ}),VN=yN.map(function(MJ){return MJ.offlineVideoPolicy}).filter(function(MJ){return!!MJ}),t=yN.filter(function(MJ){return!!MJ.key}).map(function(MJ){return g.uK(g.EX(MJ.key).entityId,"downloadStatusEntity")});
Hz=eQ(d,"transfer",Hz);VN=eQ(d,"offlineVideoPolicy",VN);t=eQ(d,"downloadStatusEntity",t);var NJ=Hz.then(function(MJ){MJ=MJ.reduce(function(TZ,GZ){(GZ==null?0:GZ.offlineVideoStreams)&&TZ.push.apply(TZ,g.Y(GZ.offlineVideoStreams));return TZ},[]).filter(function(TZ){return!!TZ});
return eQ(d,"offlineVideoStreams",MJ)});
return g.o$.all([Hz,VN,NJ,t]).then(function(MJ){var TZ=g.a(MJ);MJ=TZ.next().value;var GZ=TZ.next().value;var pp=TZ.next().value;TZ=TZ.next().value;return[yN,MJ,GZ,pp,TZ]})})}),2);
if(B.G!=3)return y=B.K,g.h(B,kp(l,{mode:"readonly",L$:!0},function(d){return eQ(d,"mainDownloadsListEntity").then(function(yN){var Hz,VN;return(VN=(Hz=yN[0])==null?void 0:Hz.downloads)!=null?VN:[]})}),3);
r=B.K;c=g.a(y);O=c.next().value;H=c.next().value;V=c.next().value;T=c.next().value;f=c.next().value;N=O;S=H;F=V;p=T;E=f;u={};I={};q={};W={};v={};G=[];D=g.a(S);for(w=D.next();!w.done;w=D.next())(U=w.value)&&(u[U.key]=U);R=g.a(F);for(ON=R.next();!ON.done;ON=R.next())(Cl=ON.value)&&(I[Cl.key]=Cl);ls=g.a(E);for(x=ls.next();!x.done;x=ls.next())(L=x.value)&&(q[L.key]=L);K=g.a(p);for(e=K.next();!e.done;e=K.next())(Xv=e.value)&&(W[Xv.key]=Xv);Ig=g.a(r);for(FQ=Ig.next();!FQ.done;FQ=Ig.next())vz=FQ.value,jC=
void 0,v[(jC=vz.videoItem)!=null?jC:""]=!0,vz.videoItem&&(uj=Hx=void 0,A=(uj=(Hx=g.EX(vz.videoItem))==null?void 0:Hx.entityId)!=null?uj:"",G.push({externalVideoId:A}));m=N.filter(function(d){if(!d||!d.key||!d.offlineVideoPolicy)return!1;d=g.EX(d.key).entityId;d=g.uK(d,"downloadStatusEntity");var yN;return!(d&&((yN=q[d])==null?void 0:yN.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
J=m.map(function(d){var yN=u[d.transfer],Hz=[];if(yN==null?0:yN.offlineVideoStreams)for(var VN=g.a(yN.offlineVideoStreams),t=VN.next();!t.done;t=VN.next())(t=W[t.value])&&Hz.push(t);VN=I[d.offlineVideoPolicy];t=v;var NJ=d==null?void 0:d.playerResponseTimestamp,MJ=g.EX(VN.key).entityId;d=g.uK(MJ,"mainVideoEntity");if(VN.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var TZ="OFFLINE_VIDEO_STATE_DISABLED";VN.expirationTimestamp&&Number(VN.expirationTimestamp)<Date.now()/1E3&&(TZ="OFFLINE_VIDEO_STATE_EXPIRED")}else if(VN.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")TZ="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(yN==null?void 0:yN.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":TZ="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":TZ="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":TZ="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":TZ="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":TZ="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":TZ="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:TZ="OFFLINE_VIDEO_STATE_UNKNOWN"}if(TZ==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(yN==null?void 0:yN.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":TZ="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":TZ="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":TZ=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}MJ={id:MJ,videoState:TZ};if(yN==null?0:yN.cotn)MJ.cotn=yN.cotn;if(yN==null?0:yN.maximumDownloadQuality)MJ.selectedVideoQuality=yN==null?void 0:yN.maximumDownloadQuality;if(yN==null?0:yN.lastProgressTimeMs)MJ.lastProgressTimeMs=yN.lastProgressTimeMs;NJ&&(MJ.playerResponseSavedTimeMs=String(Number(NJ)*1E3));yN=String;NJ=0;Hz=g.a(Hz);for(TZ=Hz.next();!TZ.done;TZ=Hz.next())if(TZ=TZ.value,TZ.streamsProgress){TZ=g.a(TZ.streamsProgress);for(var GZ=TZ.next();!GZ.done;GZ=
TZ.next()){var pp=void 0;NJ+=Number((pp=GZ.value.numBytesDownloaded)!=null?pp:0)}}MJ.downloadedBytes=yN(NJ);MJ.selectedOfflineMode=t[d]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";VN.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(MJ.offlinePlaybackDisabledReason=VN.offlinePlaybackDisabledReason);return MJ});
return B.return({offlineVideos:J,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:G}}})})},x0g=function(){this.locks=navigator.locks},eNp=function(){try{var l=g.Pz("ytglobal.locks_");
if(l)return l;var y;if(y=navigator){var r=navigator;y="locks"in r&&!!r.locks}if(y)return g.QN.localStorage&&g.QN.localStorage.getItem("noop"),l=new x0g,g.wd("ytglobal.locks_",l),l}catch(c){}},rI=function(){},nip=function(){},bdz=function(l){if(l.includes(":"))throw Error("Invalid user cache name: "+l);
return l+":"+g.lz("CacheStorage get")},RNj=function(){return g.Z(function(l){if(cV!==void 0)return l.return(cV);
cV=new Promise(function(y){var r;return g.Z(function(c){switch(c.G){case 1:return g.Im(c,2),g.h(c,O$.open("test-only"),4);case 4:return g.h(c,O$.delete("test-only"),5);case 5:g.qJ(c,3);break;case 2:if(r=g.AW(c),r instanceof Error&&r.name==="SecurityError")return y(!1),c.return();case 3:y("caches"in window),g.Kl(c)}})});
return l.return(cV)})},zNj=function(){return g.Z(function(l){if(l.G==1)return g.h(l,RNj(),2);
if(!l.K)return l.return(void 0);U0x||(U0x=new nip);return l.return(U0x)})},HV=function(l,y,r){g.Pv(new g.Lr("Woffle: "+l,r?{cotn:r}:""));
y instanceof Error&&g.Pv(y)},kmz=function(l){var y;
return g.Z(function(r){if(r.G==1)return g.h(r,PJJ(l),2);y=r.K;g.EE("offlineStateSnapshot",y);g.Kl(r)})},VS=function(l){g.X.call(this);
var y=this;this.api=l;this.GT={iL8:function(){return y.G},
oxw:function(){return y.K}};
typeof g.QN.BroadcastChannel!=="undefined"&&(this.G=new g.QN.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.lz()),this.G.onmessage=this.N.bind(this),this.K=new g.QN.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.lz()),this.K.onmessage=this.B.bind(this))},Cm=function(l,y){l.api.HT("onOfflineOperationFailure",y);
var r;(r=l.G)==null||r.postMessage(y)},jAJ=function(l,y,r,c){var O=this;
this.W=l;this.X=y;this.visibility=r;this.j=c;this.C=this.J=this.L=this.N=this.G=!1;this.B=new g.yU(function(){O.PV()});
this.GT={v9:function(){return O.K},
PV:function(){O.PV()},
ZL9:function(){return O.B}};
this.visibility.subscribe("visibilitystatechange",function(){O.G$()})},LKH=function(l){if(!l.N&&!l.G){var y=eNp();
if(y){l.N=!0;var r=g.lz("OfflineLockManager");y.request("woffle_orchestration_leader:"+r,{},function(){var c,O,H,V;return g.Z(function(T){switch(T.G){case 1:return g.Im(T,2),l.K=new g.sy,l.G=!0,l.N=!1,g.h(T,l.W(),4);case 4:return g.h(T,l.K.promise,5);case 5:g.qJ(T,0);break;case 2:c=g.AW(T),((H=(O=l).j)==null?0:H.call(O,"wo_relinquish_leadership_on_lock_request_error"))||l.PV(),c instanceof Error&&(V=c,V.args=[{name:"WoLockManagerError",VR:c.name}],g.wV(V)),g.Kl(T)}})})}}},lNj=function(l){l.G&&(l.C=
!0,gI(l))},y9p=function(l,y){l.G&&(l.L=y,gI(l))},r9J=function(l,y){l.G&&(l.J=y,gI(l))},gI=function(l){l.J&&l.L&&l.C&&l.visibility.isBackground()?g.rD(l.B,6E4):l.B.stop()},T0=function(l){var y;
l.offlineDeleteReason=(y=l.offlineDeleteReason)!=null?y:"OFFLINE_DELETE_REASON_UNKNOWN";var r;l.offlineModeType=(r=l.offlineModeType)!=null?r:"OFFLINE_NOW";g.EE("offlineDeleteEvent",l)},fm=function(l,y){var r=y.videoId;
var c=y.On;y=y.offlineModeType;l.encryptedVideoId=r;l.cotn=c==null?void 0:c.cotn;l.offlineabilityFormatType=c==null?void 0:c.maximumDownloadQuality;var O;l.isRefresh=(O=c==null?void 0:c.isRefresh)!=null?O:!1;var H;l.softErrorCount=(H=c==null?void 0:c.transferRetryCount)!=null?H:0;l.offlineModeType=y!=null?y:"OFFLINE_NOW";(l.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&l.statusType==="UNKNOWN_STATUS_TYPE"||!l.transferStatusType&&!l.statusType)&&g.Pv(Error("Woffle unknown transfer status"));
g.EE("offlineTransferStatusChanged",l)},c9J=function(l,y,r,c){c={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!c};y&&r&&(y=Math.floor(y/1024).toFixed(),r=Math.floor(r/1024).toFixed(),c.alreadyDownloadedKbytes=y,c.totalFetchedKbytes=y,c.totalContentKbytes=r);fm(c,l)},Oog=function(l){fm({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},l)},HoJ=function(l){switch(l){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
NC=function(l){var y,r,c;
return((c=(y=l.actionMetadata)==null?void 0:(r=y.retryScheduleIntervalsInSeconds)==null?void 0:r.length)!=null?c:0)>0},S3=function(l){return l.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!l.entityKey},FU=function(l){return l.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!l.entityKey},pm=function(l){return l.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!l.entityKey},Vfg=function(l){return l.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!l.entityKey},
E$=function(l,y,r,c,O){O=O===void 0?!1:O;
var H,V,T,f,N,S;return g.Z(function(F){if(F.G==1)return H=g.uK(l,y),V=g.uK(l,"downloadStatusEntity"),g.h(F,kp(r,{mode:"readonly",L$:!0},function(p){return g.o$.all([xp(p,H,y),xp(p,V,"downloadStatusEntity")])}),2);
T=F.K;f=T.length?T[0]:void 0;if(!f)return F.Ez(0);N=Cvj;if(S=T.length>1?T[1]:void 0){if(S.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!O)return F.return();S.downloadState=c}else S={key:V,downloadState:c};g.Rn(f,N,S);return g.h(F,kp(r,{mode:"readwrite",L$:!0},function(p){return g.o$.all([bP(p,f,y),bP(p,S,"downloadStatusEntity")])}),0)})},uL=function(l,y){return l.actionType===y.actionType&&l.entityKey===y.entityKey},MC=function(l,y){if(l&&l.transferState!=="TRANSFER_STATE_COMPLETE"&&l.transferState!==
"TRANSFER_STATE_FAILED"){var r=g.EX(l.key).entityId;
fm({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:r,On:l,offlineModeType:y})}},a6=function(l){if(!l||!l.thumbnails)return[];
var y=[];l=g.a(l.thumbnails);for(var r=l.next();!r.done;r=l.next())r=r.value,r.url&&y.push(r.url);return y},gXH=function(l,y,r){r=r===void 0?[]:r;
var c,O,H,V,T,f,N,S,F,p,E,u,I;return g.Z(function(q){if(q.G==1)return r.length?g.h(q,lL(l,y),2):q.return([]);c=q.K;O=new Set;H=g.a(c);for(V=H.next();!V.done;V=H.next())if(T=V.value,f=T.id||T.key)N=g.EX(f).entityId,O.add(N);S=[];F=g.a(r);for(p=F.next();!p.done;p=F.next())E=p.value,u=E.offlineVideoData,I=void 0,((I=u)==null?0:I.videoId)&&!O.has(u.videoId)&&S.push(E);return q.return(S)})},Tnb=function(l,y,r){return new g.jM(l,{cotn:y,
raw_player_response:r,download_media:!0,start:Infinity,disable_watch_next:!0})},fNB=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},s$=function(l,y,r,c,O,H,V,T,f,N,S){this.entityType=l;
this.actionId=y;this.action=r;this.parentActionId=c;this.rootActionId=O===void 0?y:O;this.childActionIds=H;this.prereqActionId=V;this.postreqActionIds=T;this.hasChildActionFailed=N;this.retryScheduleIndex=0;this.G=S||Date.now();this.retryScheduleIndex=f||0},Km=function(l){if(!l.key)throw Error("Entity key is required.");
if(!l.actionProto)throw Error("OfflineOrchestrationAction is required.");var y=g.EX(l.key),r=g.EX(l.actionProto.entityKey);return new s$(r.entityType,y.entityId,l.actionProto,l.parentActionId,l.rootActionId,l.childActionIds,l.prereqActionId,l.postreqActionIds,l.retryScheduleIndex,l.hasChildActionFailed,Number(l.enqueueTimeSec)*1E3)},I6=function(l){return{key:g.uK(l.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:l.action,parentActionId:l.parentActionId,rootActionId:l.rootActionId,childActionIds:l.childActionIds,prereqActionId:l.prereqActionId,postreqActionIds:l.postreqActionIds,retryScheduleIndex:l.retryScheduleIndex,hasChildActionFailed:l.hasChildActionFailed,enqueueTimeSec:(l.G/1E3).toFixed()}},Nng=function(){var l;
return g.Z(function(y){return y.G==1?g.h(y,zNj(),2):(l=y.K)?y.return(l.delete("yt-player-local-img")):y.return(!0)})},Y6=function(l){var y,r;
return g.Z(function(c){if(c.G==1)return g.h(c,zNj(),2);if(c.G!=3){y=c.K;if(!y)throw Error("Cache API not supported");return l.length?g.h(c,y.open("yt-player-local-img"),3):c.return()}r=c.K;return g.h(c,Promise.all(l.map(function(O){return r.delete(O)})),0)})},qC=function(l){var y,r;
return g.Z(function(c){if(c.G==1)return g.h(c,zNj(),2);if(c.G!=3){y=c.K;if(!y)throw Error("Cache API not supported");return l.length?g.h(c,y.open("yt-player-local-img"),3):c.return()}r=c.K;return g.h(c,r.addAll(l),0)})},A5=function(l,y,r,c,O){var H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl,ls,x,L,K,e,Xv,Ig,FQ,vz,jC;
return g.Z(function(Hx){switch(Hx.G){case 1:return H=g.uK(l,"mainVideoEntity"),V=g.uK(l,"ytMainChannelEntity"),T=g.uK(l,"transfer"),f=g.uK(l,"videoDownloadContextEntity"),g.h(Hx,kp(y,{mode:"readonly",L$:!0},function(uj){return g.o$.all([xp(uj,H,"mainVideoEntity"),xp(uj,V,"ytMainChannelEntity"),xp(uj,T,"transfer"),xp(uj,f,"videoDownloadContextEntity"),eQ(uj,"ytMainChannelEntity"),eQ(uj,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:N=Hx.K;S=g.a(N);F=S.next().value;p=S.next().value;E=S.next().value;u=S.next().value;I=S.next().value;q=S.next().value;W=F;v=p;G=E;D=u;w=I;U=q;if(!W&&!v){Hx.Ez(3);break}R=W?a6(W.thumbnail):[];if(!v){ON=[];Hx.Ez(4);break}return g.h(Hx,SmJ(v,w),5);case 5:ON=Hx.K;case 4:return Cl=ON,g.h(Hx,Y6(R.concat(Cl)),3);case 3:ls=[];x=g.uK(l,"downloadStatusEntity");L=g.a(U);for(K=L.next();!K.done;K=L.next())e=K.value,Xv=g.EX(e.key).entityId,Ig=Km(e),FQ=g.EX(Ig.action.entityKey).entityId,Xv!==l&&FQ!==l||uL(r,
e.actionProto)||ls.push(e.key);return g.h(Hx,kp(y,{mode:"readwrite",L$:!0},function(uj){var A=ls.map(function(m){return Ra(uj,m)});
A.push(Ra(uj,H,{Do:!0}));A.push(Ra(uj,x,{Do:!0}));return g.o$.all(A)}),7);
case 7:jC=(vz=D)==null?void 0:vz.offlineModeType,O&&(T0(O),O.offlineModeType&&(jC=O.offlineModeType)),MC(G,jC),Cm(c,{entityKey:H,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Kl(Hx)}})},EXQ=function(l,y,r,c){var O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl,ls,x,L,K,e,Xv,Ig,FQ,vz,jC,Hx,uj,A,m,J,B,d,yN,Hz,VN,t,NJ,MJ,TZ,GZ,pp,ij,Fw;
return g.Z(function(eC){switch(eC.G){case 1:return O=g.uK(l,"mainPlaylistEntity"),H=g.uK(l,"ytMainChannelEntity"),g.h(eC,kp(y,{mode:"readonly",L$:!0},function(Xw){return g.o$.all([xp(Xw,O,"mainPlaylistEntity"),xp(Xw,H,"ytMainChannelEntity"),eQ(Xw,"mainPlaylistEntity"),eQ(Xw,"mainDownloadsListEntity"),eQ(Xw,"ytMainChannelEntity"),eQ(Xw,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:V=eC.K;T=g.a(V);f=T.next().value;N=T.next().value;S=T.next().value;F=T.next().value;p=T.next().value;E=T.next().value;u=f;I=N;q=S;W=F;v=p;G=E;if(!u&&!I){eC.Ez(3);break}D=u?FOp(u):[];if(!I){w=[];eC.Ez(4);break}return g.h(eC,SmJ(I,v),5);case 5:w=eC.K;case 4:return U=w,g.h(eC,Y6(D.concat(U)),3);case 3:R=[];ON=new Map;if(!u){eC.Ez(7);break}return g.h(eC,pPz(u,q,W),8);case 8:R=eC.K;Cl=g.a(R);for(ls=Cl.next();!ls.done;ls=Cl.next())x=ls.value,ON.set(x,{videoId:x,playlistId:l,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return g.h(eC,kp(y,{mode:"readonly",L$:!0},function(Xw){return g.o$.all([eQ(Xw,"transfer"),eQ(Xw,"videoDownloadContextEntity")])}),9);
case 9:L=eC.K;K=g.a(L);e=K.next().value;Xv=K.next().value;Ig=e;FQ=Xv;vz=g.a(Ig);for(jC=vz.next();!jC.done;jC=vz.next())Hx=jC.value,uj=g.EX(Hx.key).entityId,(A=ON.get(uj))&&Hx&&(A.cotn=Hx.cotn);m=g.a(FQ);for(J=m.next();!J.done;J=m.next())B=J.value,d=g.EX(B.key).entityId,(yN=ON.get(d))&&B&&(yN.offlineModeType=B.offlineModeType);case 7:Hz=[];VN=g.a(G);for(t=VN.next();!t.done;t=VN.next())NJ=t.value,MJ=g.EX(NJ.key).entityId,TZ=Km(NJ),MJ!==l&&TZ.rootActionId!==l||uL(r,NJ.actionProto)||Hz.push(NJ.key);GZ=
g.uK(l,"mainPlaylistEntity");return g.h(eC,kp(y,{mode:"readwrite",L$:!0},function(Xw){var gc=Hz.map(function(Z0){return Ra(Xw,Z0)});
gc.push(Ra(Xw,GZ,{Do:!0}));return g.o$.all(gc)}),10);
case 10:if(!u){eC.Ez(0);break}R.reverse();if(!R){eC.Ez(0);break}pp=g.a(R);ij=pp.next();case 13:if(ij.done){eC.Ez(0);break}Fw=ij.value;return g.h(eC,A5(Fw,y,r,c,ON.get(Fw)),14);case 14:ij=pp.next(),eC.Ez(13)}})},Mfb=function(l,y,r,c){var O,H,V,T,f,N,S,F,p;
return g.Z(function(E){if(E.G==1)return O=g.uK("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),H=new Map,g.h(E,kp(l,{mode:"readwrite",L$:!0},function(u){var I=eQ(u,"transfer"),q=eQ(u,"offlineOrchestrationActionWrapperEntity"),W=eQ(u,"videoDownloadContextEntity"),v=xp(u,O,"mainDownloadsListEntity");return g.o$.all([I,q,W,v]).then(function(G){G=g.a(G);var D=G.next().value;var w=G.next().value;var U=G.next().value;var R=G.next().value;G=uFB.map(function(Cl){return FKg(u,Cl)});
w=g.a(w);for(var ON=w.next();!ON.done;ON=w.next())ON=ON.value,uL(y,ON.actionProto)||G.push(Ra(u,ON.key,{Do:!0}));R&&(R.downloads=[],G.push(bP(u,R,"mainDownloadsListEntity")));if(U)for(U=g.a(U),R=U.next();!R.done;R=U.next())R=R.value,w=g.EX(R.key).entityId,w=g.uK(w,"transfer"),H.set(w,R.offlineModeType);return g.o$.all(G).then(function(){return D})})}),2);
V=E.K;T=g.a(V);for(f=T.next();!f.done;f=T.next())N=f.value,MC(N,H.get(N.key)),S=g.EX(N.key).entityId,F={videoId:S,offlineDeleteReason:c,cotn:N.cotn,offlineModeType:H.get(N.key)},T0(F),p=g.uK(S,"mainVideoEntity"),Cm(r,{entityKey:p,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.h(E,Nng(),0)})},FOp=function(l,y){var r=[];
if(l.thumbnailStyleData){l=g.a(l.thumbnailStyleData);for(var c=l.next();!c.done;c=l.next()){var O=void 0,H=void 0,V=void 0;r=r.concat(a6((O=c.value)==null?void 0:(H=O.value)==null?void 0:(V=H.collageThumbnail)==null?void 0:V.coverThumbnail))}}y=a6(y);return r.concat(y)},pPz=function(l,y,r){var c,O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl;
return g.Z(function(ls){c=[];O=new Set;if(r.length)for(H=g.a(r),V=H.next();!V.done;V=H.next())if(T=V.value,f=void 0,(f=T.downloads)==null?0:f.length)for(N=g.a(T.downloads),S=N.next();!S.done;S=N.next())F=S.value,F.videoItem&&(p=g.EX(F.videoItem).entityId,O.add(p));if(l.videos){E=g.a(l.videos);for(u=E.next();!u.done;u=E.next())I=u.value,q=JSON.parse(g.EX(I).entityId),q.videoId&&!O.has(q.videoId)&&c.push(q.videoId);W=g.a(y);for(v=W.next();!v.done;v=W.next())if(G=v.value,G.key!==l.key&&(D=G.videos))for(w=
g.a(D),U=w.next();!U.done;U=w.next())R=U.value,ON=JSON.parse(g.EX(R).entityId),ON.videoId&&(Cl=c.indexOf(ON.videoId),Cl!==-1&&c.splice(Cl,1))}return ls.return(c)})},SmJ=function(l,y){var r,c,O,H,V,T,f,N;
return g.Z(function(S){r=a6(l.avatar);c=g.a(y);for(O=c.next();!O.done;O=c.next())if(H=O.value,H.id!==l.id)for(V=g.a(a6(H.avatar)),T=V.next();!T.done;T=V.next())f=T.value,N=r.indexOf(f),N!==-1&&r.splice(N,1);return S.return(r)})},aNx=function(l){var y;
return g.Z(function(r){y=g.P(l.frameworkUpdates,WV);return l.frameworkUpdates&&y?g.h(r,m0J(y),0):r.return()})},KOx=function(l){var y;
if((y=l.onResponseReceivedActions)!=null&&y.length){var r;l=(r=g.P(g.P(l.onResponseReceivedActions[0],sKg),g.$lz))==null?void 0:r.actions;if(l!=null&&l.length)return l}},INJ=function(l){var y,r,c;
return g.Z(function(O){if(O.G==1)return l?g.h(O,LB(l,g.tu,"mainDownloadsListEntity"),2):O.return([]);y=O.K;return((r=y)==null?0:(c=r.downloads)==null?0:c.length)?O.return(y.downloads.map(function(H){var V;return(V=H.videoItem)!=null?V:""})):O.return([])})},qmz=function(l,y){var r;
return g.Z(function(c){return c.G==1?g.h(c,Ymg(l,y),2):(r=c.K)?g.h(c,kp(l,{mode:"readwrite",L$:!0},function(O){var H=[bP(O,r.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];r.mainDownloadsListEntity&&H.push(bP(O,r.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.o$.all(H)}),0):c.Ez(0)})},Ymg=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G;
return g.Z(function(D){if(D.G==1)return r=g.uK("main_downloads_library_id","mainDownloadsLibraryEntity"),c=g.uK("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.h(D,kp(l,{mode:"readonly",L$:!0},function(w){return g.o$.all([xp(w,r,"mainDownloadsLibraryEntity"),xp(w,c,"mainDownloadsListEntity")])}),2);
O=D.K;H=g.a(O);V=H.next().value;T=H.next().value;f=V;N=T;f||(f={id:r});S=g.a(y);for(F=S.next();!F.done;F=S.next())if(p=F.value,p===g.tu){if(f.smartDownloadsList)return D.return();f.smartDownloadsList=p}else if(E=g.EX(p).entityType,u={},E==="mainPlaylistEntity"?u.playlistItem=p:E==="mainVideoEntity"&&(u.videoItem=p),!g.GR(u)){I=void 0;if((I=N)==null?0:I.downloads){q=!1;W=g.a(N.downloads);for(v=W.next();!v.done;v=W.next())if(G=v.value,G.playlistItem===p||G.videoItem===p){q=!0;break}q||N.downloads.push(u)}else N=
{id:c,downloads:[u]};f.downloadsList=c}return D.return({mainDownloadsLibraryEntity:f,mainDownloadsListEntity:N})})},A9J=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q;
return g.Z(function(W){if(W.G==1)return r=g.uK("main_downloads_library_id","mainDownloadsLibraryEntity"),c=g.uK("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),g.h(W,kp(l,{mode:"readonly",L$:!0},function(v){return g.o$.all([xp(v,r,"mainDownloadsLibraryEntity"),xp(v,c,"mainDownloadsListEntity"),xp(v,g.tu,"mainDownloadsListEntity")])}),2);
O=W.K;H=g.a(O);V=H.next().value;T=H.next().value;f=H.next().value;N=V;S=T;F=f;if(!N)return W.Ez(0);if(y===g.tu&&((p=F)==null?0:p.downloads))F.downloads=[];else if((E=S)==null?0:E.downloads)for(u=g.EX(y).entityType,I=0;I<S.downloads.length;I++)if(q=S.downloads[I],u==="mainVideoEntity"&&q.videoItem===y){S.downloads.splice(I,1);break}else if(u==="mainPlaylistEntity"&&q.playlistItem===y){S.downloads.splice(I,1);break}return g.h(W,kp(l,{mode:"readwrite",L$:!0},function(v){var G=[bP(v,N,"mainDownloadsLibraryEntity")];
S&&G.push(bP(v,S,"mainDownloadsListEntity"));F&&G.push(bP(v,F,"mainDownloadsListEntity"));return g.o$.all(G)}),0)})},mp=function(l,y){var r,c,O,H,V,T,f,N,S,F,p;
return g.Z(function(E){if(E.G==1)return r=g.uK(y,"transfer"),c=g.uK(y,"videoDownloadContextEntity"),g.h(E,kp(l,{mode:"readonly",L$:!0},function(u){return g.o$.all([xp(u,r,"transfer"),xp(u,c,"videoDownloadContextEntity")])}),2);
O=E.K;H=g.a(O);V=H.next().value;T=H.next().value;f=V;N=T;p={videoId:y,cotn:(S=f)==null?void 0:S.cotn,offlineModeType:(F=N)==null?void 0:F.offlineModeType};return E.return(p)})},vV=function(l,y,r,c,O){var H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON;
return g.Z(function(Cl){switch(Cl.G){case 1:return H=g.uK(l,"musicTrack"),V=g.uK(l,"transfer"),g.h(Cl,kp(y,{mode:"readonly",L$:!0},function(ls){return g.o$.all([xp(ls,H,"musicTrack"),xp(ls,V,"transfer"),eQ(ls,"musicTrack"),eQ(ls,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:T=Cl.K;f=g.a(T);N=f.next().value;S=f.next().value;F=f.next().value;p=f.next().value;E=N;u=S;I=F;q=p;if(!E){Cl.Ez(3);break}return g.h(Cl,WOJ(E,I),4);case 4:return W=Cl.K,g.h(Cl,Y6(W),3);case 3:v=[];G=g.a(q);for(D=G.next();!D.done;D=G.next())w=D.value,U=g.EX(w.key).entityId,R=Km(w),ON=g.EX(R.action.entityKey).entityId,U!==l&&ON!==l||uL(r,w.actionProto)||v.push(w.key);return g.h(Cl,kp(y,{mode:"readwrite",L$:!0},function(ls){var x=v.map(function(L){return Ra(ls,L)});
x.push(Ra(ls,H,{Do:!0}));return g.o$.all(x)}),6);
case 6:MC(u),O&&T0(O),Cm(c,{entityKey:H,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),g.Kl(Cl)}})},J5=function(l,y,r,c,O){var H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl,ls,x,L,K,e,Xv,Ig,FQ,vz,jC,Hx,uj,A,m,J;
return g.Z(function(B){switch(B.G){case 1:return H=g.uK(l,y),V=g.uK("music_downloads_library_id","musicDownloadsLibraryEntity"),g.h(B,kp(r,{mode:"readonly",L$:!0},function(d){return g.o$.all([xp(d,H,y),xp(d,V,"musicDownloadsLibraryEntity"),eQ(d,y),eQ(d,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:T=B.K;f=g.a(T);N=f.next().value;S=f.next().value;F=f.next().value;p=f.next().value;E=N;u=S;I=F;q=p;if(!E){B.Ez(3);break}return g.h(B,WOJ(E,I),4);case 4:return W=B.K,g.h(B,Y6(W),3);case 3:v=[];G=new Map;if(!E){B.Ez(6);break}return g.h(B,mPB(E,I,u),7);case 7:v=B.K;D=g.a(v);for(w=D.next();!w.done;w=D.next())U=w.value,R=g.EX(U).entityId,G.set(R,{videoId:R,playlistId:l,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return g.h(B,lL(r,"transfer"),8);case 8:for(ON=B.K,Cl=g.a(ON),
ls=Cl.next();!ls.done;ls=Cl.next())x=ls.value,L=g.EX(x.key).entityId,(K=G.get(L))&&x&&(K.cotn=x.cotn);case 6:e=[];Xv=g.a(q);for(Ig=Xv.next();!Ig.done;Ig=Xv.next())FQ=Ig.value,vz=g.EX(FQ.key).entityId,jC=Km(FQ),vz!==l&&jC.rootActionId!==l||uL(c,FQ.actionProto)||e.push(FQ.key);Hx=g.uK(l,y);return g.h(B,kp(r,{mode:"readwrite",L$:!0},function(d){var yN=e.map(function(Hz){return Ra(d,Hz)});
yN.push(Ra(d,Hx,{Do:!0}));return g.o$.all(yN)}),9);
case 9:if(!E){B.Ez(0);break}v.reverse();if(!v.length){B.Ez(0);break}uj=g.a(v);A=uj.next();case 12:if(A.done){B.Ez(0);break}m=A.value;J=g.EX(m).entityId;if(!J){B.Ez(13);break}return g.h(B,vV(J,r,c,O,G.get(J)),13);case 13:A=uj.next(),B.Ez(12)}})},o6=function(l,y,r){var c,O,H,V,T,f,N;
return g.Z(function(S){if(S.G==1)return g.h(S,kp(l,{mode:"readwrite",L$:!0},function(F){var p=eQ(F,"transfer"),E=eQ(F,"offlineOrchestrationActionWrapperEntity");return g.o$.all([p,E]).then(function(u){u=g.a(u);var I=u.next().value;var q=u.next().value;u=vXz.map(function(D){return FKg(F,D)});
q=g.a(q);for(var W=q.next();!W.done;W=q.next()){W=W.value;var v=g.EX(W.actionProto.entityKey).entityType==="musicTrack",G=W.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";uL(y,W.actionProto)||v&&(!v||G)||u.push(Ra(F,W.key,{Do:!0}))}return g.o$.all(u).then(function(){return I})})}),2);
c=S.K;O=g.a(c);for(H=O.next();!H.done;H=O.next())V=H.value,MC(V),T=g.EX(V.key).entityId,f={videoId:T,offlineDeleteReason:void 0,cotn:V.cotn},T0(f),N=g.uK(T,"musicTrack"),Cm(r,{entityKey:N,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return g.h(S,Nng(),0)})},J9j=function(l){for(var y,r=g.a(l.additionalMetadatas),c=r.next();!c.done;c=r.next())c=c.value,c.offlineMusicVideoData&&(y=c.offlineMusicVideoData);
var O,H,V,T,f;return{id:g.uK(l.videoId,"musicTrack"),videoId:l.videoId,title:l.title,thumbnailDetails:l.thumbnail,lengthMs:String(Number(l.lengthSeconds)*1E3),albumTitle:(O=y)==null?void 0:O.releaseTitle,musicVideoType:(H=y)==null?void 0:H.musicVideoType,contentRating:{explicitType:(V=y)==null?void 0:V.explicitType},artistNames:((T=y)==null?void 0:T.byline)||((f=y)==null?void 0:f.channelName),downloadMetadata:g.uK(l.videoId,"musicTrackDownloadMetadataEntity")}},mPB=function(l,y,r){var c,O,H,V,T,f,
N,S,F,p,E,u,I,q,W,v,G,D;
return g.Z(function(w){c=[];O=new Set;if((H=r)==null?0:(V=H.downloadedTracks)==null?0:V.length)for(T=g.a(r.downloadedTracks),f=T.next();!f.done;f=T.next())N=f.value,O.add(N);if(l.tracks){S=g.a(l.tracks);for(F=S.next();!F.done;F=S.next())p=F.value,O.has(p)||c.push(p);E=g.a(y);for(u=E.next();!u.done;u=E.next())if(I=u.value,I.id!==l.id&&(q=I.tracks))for(W=g.a(q),v=W.next();!v.done;v=W.next())G=v.value,D=c.indexOf(G),D!==-1&&c.splice(D,1)}return w.return(c)})},WOJ=function(l,y){var r,c,O,H,V,T,f,N;
return g.Z(function(S){r=a6(l.thumbnailDetails);c=g.a(y);for(O=c.next();!O.done;O=c.next())if(H=O.value,H.id!==l.id)for(V=g.a(a6(H.thumbnailDetails)),T=V.next();!T.done;T=V.next())f=T.value,N=r.indexOf(f),N!==-1&&r.splice(N,1);return S.return(r)})},oXQ=function(l,y){var r,c,O,H,V,T,f,N,S;
return g.Z(function(F){if(F.G==1)return r=g.uK("music_downloads_library_id","musicDownloadsLibraryEntity"),g.h(F,LB(l,r,"musicDownloadsLibraryEntity"),2);(c=F.K)||(c={id:r});O=g.EX(y).entityType;O==="musicTrack"?(H=c.downloadedTracks)!=null&&H.includes(y)||(c.downloadedTracks=((V=c.downloadedTracks)!=null?V:[]).concat(y)):O==="musicPlaylist"?(T=c.downloadedPlaylists)!=null&&T.includes(y)||(c.downloadedPlaylists=((f=c.downloadedPlaylists)!=null?f:[]).concat(y)):O!=="musicAlbumRelease"||(N=c.downloadedAlbumReleases)!=
null&&N.includes(y)||(c.downloadedAlbumReleases=((S=c.downloadedAlbumReleases)!=null?S:[]).concat(y));return g.h(F,jQ(l,c,"musicDownloadsLibraryEntity"),0)})},hTJ=function(l,y){var r,c,O,H,V,T,f;
return g.Z(function(N){if(N.G==1)return r=g.uK("music_downloads_library_id","musicDownloadsLibraryEntity"),g.h(N,LB(l,r,"musicDownloadsLibraryEntity"),2);c=N.K;if(!c)return N.Ez(0);O=g.EX(y).entityType;O==="musicTrack"?H=c.downloadedTracks:O==="musicPlaylist"&&(H=c.downloadedPlaylists);if((V=H)==null?0:V.length)for(T=0;T<H.length;T++)if(f=H[T],f===y){H.splice(T,1);break}return g.h(N,jQ(l,c,"musicDownloadsLibraryEntity"),0)})},GGj=function(l){var y=l.videos;
l=[];var r=[];if(y){y=g.a(y);for(var c=y.next();!c.done;c=y.next()){var O=c.value.offlineVideoData.videoId;c=g.uK(O,"musicTrack");O=g.uK(O,"musicTrackDownloadMetadataEntity");l.push(c);r.push(O)}}return{M7:l,EY:r}},h5=function(l,y,r){y={track:J9j(y)};
r&&(y.playlistId=r);if(l=g.P(l.actionMetadata,ZoQ))y.maximumDownloadQuality=l.maximumDownloadQuality;return{musicTrackEntityActionMetadata:y}},BnB=function(l){var y,r,c,O,H,V,T,f;
return g.Z(function(N){switch(N.G){case 1:return y=g.pL(),r=B_g(l),c=g.TA($Ps),g.Im(N,2),H={PO:!0},g.h(N,g.Oh(y,r,c,void 0,H),4);case 4:O=N.K;g.qJ(N,3);break;case 2:V=g.AW(N);if(V instanceof g.yT)throw T="GetOffline network manager error: "+V.message,HV(T,V),Error(T);HV("GetOffline fetch request error",V);throw Error("GetOffline fetch request error");case 3:f=G0(O);if(!O)throw HV("Network request failed"),Error("Network request failed");if(f!==void 0)Zj(f);else if(!O.videos||!O.videos.length)throw HV("No data"),
Error("No data");return N.return(O.videos.map(function(S){return S.offlineVideoData}))}})},tfb=function(l){var y,r,c,O,H,V,T,f;
return g.Z(function(N){switch(N.G){case 1:return y=g.pL(),r=tsJ(l),c=g.TA($Ps),g.Im(N,2),H={PO:!0},g.h(N,g.Oh(y,r,c,void 0,H),4);case 4:O=N.K;g.qJ(N,3);break;case 2:V=g.AW(N);if(V instanceof g.yT)throw T="GetOffline network manager error for playlist: "+V.message,HV(T,V),Error(T);HV("GetOffline fetch request error for playlist",V);throw Error("GetOffline fetch request error for playlist");case 3:f=G0(O);if(!O)throw HV("Network request failed for playlist"),Error("Network request failed for playlist");
if(f!==void 0)Zj(f,"playlist");else if(!O.playlists||!O.playlists.length)throw HV("No data for playlist"),Error("No data for playlist");return N.return(O.playlists.map(function(S){return S.offlinePlaylistData}))}})},dPj=function(l,y,r,c){var O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl,ls,x,L,K,e,Xv,Ig,FQ;
return g.Z(function(vz){switch(vz.G){case 1:return g.h(vz,yS(),2);case 2:O=vz.K;if(!O)return vz.return([]);H=[];if((V=c)==null?0:V.length){H=c;vz.Ez(3);break}return g.h(vz,lL(O,"mainPlaylistEntity"),4);case 4:H=vz.K;case 3:if(!H.length)return vz.return([]);T=[];f=Date.now()/1E3;N=g.a(H);S=N.next();case 5:if(S.done)return T.length?g.h(vz,DPJ(T),10):vz.return([]);F=S.value;if(!F.downloadState){p=void 0;vz.Ez(8);break}return g.h(vz,LB(O,F.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:p=
vz.K;case 8:E=p;u=void 0;q=(I=(u=F)==null?void 0:u.entityMetadata)&&I.nextAutoRefreshIntervalSeconds?Number(I.nextAutoRefreshIntervalSeconds):NaN;W=Number.isNaN(q)?l:q;G=v=void 0;D=((v=E)==null?0:v.lastSyncedTimestampMillis)?Number((G=E)==null?void 0:G.lastSyncedTimestampMillis)/1E3:0;U=w=void 0;R=((w=E)==null?0:w.addedTimestampMillis)?Number((U=E)==null?void 0:U.addedTimestampMillis)/1E3:0;if(r||!I||D+W<=f){ON=[];Cl=void 0;if((Cl=F.videos)==null?0:Cl.length)for(ls=g.a(F.videos),x=ls.next();!x.done;x=
ls.next())L=x.value,K=JSON.parse(g.EX(L).entityId),K.videoId&&ON.push(K.videoId);e="0";I&&(Xv=void 0,e=String(Number((Xv=I.offlineLastModifiedTimestampSeconds)!=null?Xv:0).toFixed()));Ig={playlistId:F.playlistId,videoIds:ON,offlineLastModifiedTimestamp:e,autoSync:y,offlineDateAddedTimestamp:String(R.toFixed())};T.push(Ig)}S=N.next();vz.Ez(5);break;case 10:return FQ=vz.K,vz.return(FQ)}})},ioJ=function(){var l,y,r,c,O;
return g.Z(function(H){if(H.G==1)return g.h(H,yS(),2);if(H.G!=3)return(l=H.K)?g.h(H,lL(l,"refresh"),3):H.return(!1);y=H.K;if((r=y[0])==null||!r.refreshTime)return H.return(!1);c=Number(y[0].refreshTime);O=Date.now()/1E3;return H.return(isFinite(c)&&O>=c)})},QKj=function(l,y){var r,c,O;
return g.Z(function(H){switch(H.G){case 1:return g.Im(H,2),g.h(H,XPg(l,y),4);case 4:return c=H.K,g.h(H,aNx(c),5);case 5:r=KOx(c);g.qJ(H,3);break;case 2:O=g.AW(H),HV("getAndProcessSmartDownloadsResponse request or processing error",O);case 3:return H.return(r)}})},wPJ=function(l,y,r,c){var O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl,ls,x,L,K,e,Xv,Ig,FQ;
return g.Z(function(vz){switch(vz.G){case 1:return g.h(vz,yS(),2);case 2:O=vz.K;if(!O)return vz.return([]);H=[];if((V=c)==null?0:V.length){H=c;vz.Ez(3);break}return g.h(vz,lL(O,"musicPlaylist"),4);case 4:H=vz.K;case 3:if(!H.length)return vz.return([]);T=[];f=Date.now()/1E3;N=g.a(H);S=N.next();case 5:if(S.done)return T.length?g.h(vz,DPJ(T),10):vz.return([]);F=S.value;p=void 0;u=(E=(p=F)==null?void 0:p.entityMetadata)&&E.nextAutoRefreshIntervalSeconds?Number(E.nextAutoRefreshIntervalSeconds):NaN;I=
Number.isNaN(u)?l:u;W=q=0;v="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!F.downloadMetadata){vz.Ez(8);break}return g.h(vz,LB(O,F.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:G=vz.K,w=D=void 0,q=Number((w=(D=G)==null?void 0:D.addedTimestampMillis)!=null?w:"0")/1E3,R=U=void 0,W=Number((R=(U=G)==null?void 0:U.lastModifiedTimestampMillis)!=null?R:"0")/1E3,Cl=ON=void 0,v=(Cl=(ON=G)==null?void 0:ON.syncState)!=null?Cl:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:ls=void 0;if(r||v!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||
!E||Number((ls=E.lastSyncedTimestampSeconds)!=null?ls:0)+I<=f){x=[];L=void 0;if((L=F.tracks)==null?0:L.length)for(K=g.a(F.tracks),e=K.next();!e.done;e=K.next())Xv=e.value,x.push(g.EX(Xv).entityId);Ig={playlistId:F.playlistId,videoIds:x,offlineLastModifiedTimestamp:String(W.toFixed()),autoSync:y,offlineDateAddedTimestamp:String(q.toFixed())};T.push(Ig)}S=N.next();vz.Ez(5);break;case 10:return FQ=vz.K,vz.return(FQ)}})},XPg=function(l,y){var r,c,O,H,V,T,f,N,S,F;
return g.Z(function(p){switch(p.G){case 1:return r=g.pL(),g.h(p,yS(),2);case 2:c=p.K;if(!c){p.Ez(3);break}return g.h(p,PJJ(c),4);case 4:O=p.K;case 3:var E=O;H={context:g.Vo(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:l},offlineClientState:E,clientStateRequestData:{preferredFormatType:y}}}};V=g.TA(PvJ);g.Im(p,5);f={PO:!0};return g.h(p,g.Oh(r,H,V,void 0,f),7);case 7:T=p.K;g.qJ(p,6);break;case 5:N=g.AW(p);if(N instanceof g.yT)throw S=
"DPS network manager error for smart downloads: "+N.message,HV(S,N),Error(S);HV("DPS fetch request error for smart downloads",N);throw Error("DPS fetch request error for smart downloads");case 6:F=G0(T);if(T)F!==void 0&&Zj(F,"smart downloads");else throw HV("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return p.return(T)}})},eTQ=function(l,y){var r,c,O,H,V,T,f,N;
return g.Z(function(S){switch(S.G){case 1:return r=g.pL(),c={context:g.Vo(),videoPlaybackPositionEntities:l,lastSyncTimestampUsec:y},O=g.TA(xPB),g.Im(S,2),V={PO:!0},g.h(S,g.Oh(r,c,O,void 0,V),4);case 4:H=S.K;g.qJ(S,3);break;case 2:T=g.AW(S);if(T instanceof g.yT)throw f="VPPS network manager error: "+T.message,HV(f,T),Error(f);HV("VPPS fetch request error",T);throw Error("VPPS fetch request error");case 3:N=G0(H);if(H)N!==void 0&&Zj(N,"position sync");else throw HV("Network request failed for position sync"),
Error("Network request failed for position sync");return S.return(H)}})},boQ=function(l,y,r){var c,O,H,V,T,f,N,S;
return g.Z(function(F){switch(F.G){case 1:c=g.pL();var p=r.refreshData,E=r.isEnqueuedForExpiredStreamUrlRefetch,u=r.tR,I=r.offlineSourceData,q=r.mediaCapabilities,W={entityKey:l};p&&(W.refreshData=p);E&&(W.isExpiredStreamUrlRefetch=E);u&&(W.downloadParameters=u);I&&(W.offlineSourceData=I);p={context:g.S1(y),signatureTimestamp:20165,videos:[W]};q&&(p.mediaCapabilities=q);O=p;H=g.TA(nXg);g.Im(F,2);T={PO:!0};return g.h(F,g.Oh(c,O,H,void 0,T),4);case 4:V=F.K;g.qJ(F,3);break;case 2:f=g.AW(F);if(f instanceof
g.yT)throw N="GetPDE network manager error: "+f.message,HV(N,f),Error(N);HV("GetPDE fetch request error",f);throw Error("GetPDE fetch request error");case 3:S=G0(V);if(V)S!==void 0&&Zj(S,"PDE");else throw HV("Network request failed for PDE"),Error("Network request failed for PDE");return F.return(V)}})},G0=function(l){var y;
return(y=l.errorMetadata)==null?void 0:y.status},Zj=function(l,y){y=y?" for "+y:"";
if(l===0)throw l="Empty response body"+y,HV(l),Error(l);l="Response with error"+y;HV(l);throw Error(l);},DPJ=function(l){var y,r,c,O,H,V,T,f;
return g.Z(function(N){switch(N.G){case 1:return y=g.pL(),r=D0s(l),c=g.TA(RTQ),g.Im(N,2),H={PO:!0},g.h(N,g.Oh(y,r,c,void 0,H),4);case 4:O=N.K;g.qJ(N,3);break;case 2:V=g.AW(N);if(V instanceof g.yT)throw T="offlinePlaylistSyncCheck network manager error: "+V.message,HV(T,V),Error(T);HV("offlinePlaylistSyncCheck fetch request error",V);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:f=G0(O);if(!O)throw HV("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(f!==void 0)Zj(f,"playlist sync");else if(!O.offlinePlaylistSyncCheckDatas||!O.offlinePlaylistSyncCheckDatas.length)throw HV("No data for playlist sync"),Error("No data for playlist sync");return N.return(O.offlinePlaylistSyncCheckDatas.map(function(S){return S.offlinePlaylistSyncCheckData}))}})},$6=function(l){this.G=l},UPx=function(l,y){var r,c,O,H,V,T;
return g.Z(function(f){switch(f.G){case 1:r=new Map,c=g.a(y),O=c.next();case 2:if(O.done){f.Ez(4);break}H=O.value;V=r;T=V.set;return g.h(f,l.K(H),5);case 5:T.call(V,H,f.K);O=c.next();f.Ez(2);break;case 4:return f.return(r)}})},BV=function(l,y,r,c,O,H){y=g.uK(y,r);
c=Object.assign({},H,{priority:c,retryScheduleIntervalsInSeconds:O});return{actionType:l,entityKey:y,actionMetadata:c}},t5=function(l,y,r,c,O,H){this.status=l;
this.G=y;this.B=r;this.K=c;this.N=O;this.downloadState=H},zTz=function(l,y,r){this.G=l;
this.GD=y;this.N=r},LOH=function(l,y){var r,c,O,H,V,T,f,N,S;
return g.Z(function(F){switch(F.G){case 1:return r=y.entityKey,O=(c=g.P(y.actionMetadata,Dj))==null?void 0:c.isEnqueuedForExpiredStreamUrlRefetch,g.Im(F,2),H=void 0,g.h(F,kGQ(l,y),4);case 4:H=F.K;g.Im(F,5);var p=(p=g.P(y.actionMetadata,Dj))?{maximumDownloadQuality:p.maximumDownloadQuality}:void 0;return g.h(F,boQ(r,l.GD,{isEnqueuedForExpiredStreamUrlRefetch:O,tR:p,offlineSourceData:H}),7);case 7:V=F.K;g.qJ(F,6,2);break;case 5:return g.AW(F,2),T=NC(y)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",HV("PDE handleAdd error"),F.return(dI(y,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",T,"DOWNLOAD_STATE_FAILED"));case 6:return g.h(F,jKJ(l,V,y),8);case 8:return F.return(dI(y,!0,V.orchestrationActions));case 2:return f=g.AW(F),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",S="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",f instanceof g.Y$&&f.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
S="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),HV("PDE handleAdd error"),F.return(dI(y,!1,void 0,N,S,"DOWNLOAD_STATE_FAILED"))}})},r$j=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl;
return g.Z(function(ls){switch(ls.G){case 1:return r=y.entityKey,c=g.EX(r).entityId,g.h(ls,kp(l.G,{mode:"readonly",L$:!0},function(x){var L=xp(x,r,"playbackData"),K=xp(x,g.uK(c,"offlineVideoPolicy"),"offlineVideoPolicy");x=xp(x,g.uK(c,"transfer"),"transfer");return g.o$.all([L,K,x])}),2);
case 2:O=ls.K;H=g.a(O);V=H.next().value;T=H.next().value;f=H.next().value;N=V;S=T;F=f;if(!N||!S)return ls.return(dI(y,!0));p=[];I=((u=N)==null?0:u.playerResponseJson)?JSON.parse(N.playerResponseJson):null;if(!(F&&I&&l.GD.j("html5_refresh_deprecated_downloads"))){ls.Ez(3);break}E=lZg(l,I,F);return g.h(ls,y$z(l,F),4);case 4:p=ls.K;case 3:q={lastPlayerResponseTimestampSeconds:N.playerResponseTimestamp,offlineToken:S.offlineToken,formatIds:p};W={};if((v=F)==null?0:v.maximumDownloadQuality)W.maximumDownloadQuality=
F.maximumDownloadQuality;g.Im(ls,5);G=void 0;return g.h(ls,kGQ(l,y),7);case 7:return G=ls.K,g.Im(ls,8),g.h(ls,boQ(r,l.GD,{refreshData:q,tR:W,offlineSourceData:G,mediaCapabilities:E}),10);case 10:D=ls.K;g.qJ(ls,9,5);break;case 8:return g.AW(ls,5),w=NC(y)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",HV("PDE handleRefresh error"),ls.return(dI(y,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",w,
"DOWNLOAD_STATE_FAILED"));case 9:return g.h(ls,jKJ(l,D,y),11);case 11:return ls.return(dI(y,!0,D.orchestrationActions));case 5:return U=g.AW(ls),R="PDE handleRefresh error",U instanceof Error&&(R="PDE handleRefresh error: "+U.message),ON="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Cl="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",U instanceof g.Y$&&U.type==="QUOTA_EXCEEDED"&&(ON="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Cl="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
HV(R),ls.return(dI(y,!1,void 0,ON,Cl,"DOWNLOAD_STATE_FAILED"))}})},kGQ=function(l,y){var r,c,O,H;
return g.Z(function(V){if(V.G==1)return r=g.EX(y.entityKey).entityId,c=g.uK(r,"videoDownloadContextEntity"),g.h(V,LB(l.G,c,"videoDownloadContextEntity"),2);O=V.K;return(H=O)!=null&&H.offlineModeType?V.return({offlineModeType:O.offlineModeType}):V.return(void 0)})},jKJ=function(l,y,r){var c,O,H,V,T;
return g.Z(function(f){if(f.G==1){if(!y.frameworkUpdates||!g.P(y.frameworkUpdates,WV))return f.return();if(!(g.P(y.frameworkUpdates,WV).mutations&&g.P(y.frameworkUpdates,WV).mutations.length>0&&g.P(y.frameworkUpdates,WV).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return f.Ez(2);c=g.EX(g.P(y.frameworkUpdates,WV).mutations[0].entityKey).entityId;return g.h(f,mp(l.G,c),3)}if(f.G!=2){O=f.K;H=g.P(r.actionMetadata,Dj);if(T=(V=H)==null?void 0:V.playlistId)O.playlistId=T;O.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.O8(l.GD)?g.h(f,A5(c,l.G,r,l.N,O),2):g.bD(l.GD)?g.h(f,vV(c,l.G,r,l.N),2):f.Ez(2)}return g.h(f,m0J(g.P(y.frameworkUpdates,WV)),0)})},dI=function(l,y,r,c,O,H){return new t5(y?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",NC(l),r,c,O,H)},lZg=function(l,y,r){y=Tnb(l.GD,r.cotn,y);
r=g.E7(y);return g.Gyl(y,r,l.GD)},y$z=function(l,y){var r,c,O,H,V,T,f,N,S,F,p;
return g.Z(function(E){if(E.G==1)return r=[],g.h(E,kp(l.G,{mode:"readonly",L$:!0},function(u){var I=[],q=y.offlineVideoStreams;if(q){q=g.a(q);for(var W=q.next();!W.done;W=q.next())I.push(xp(u,W.value,"offlineVideoStreams"))}return g.o$.all(I)}),2);
if(c=E.K)for(O=g.a(c),H=O.next();!H.done;H=O.next())if(V=H.value,T=void 0,(T=V)==null?0:T.streamsProgress)for(f=V.streamsProgress,N=0;N<f.length;N++)S=f[N],F=JSON.parse(S.formatStreamBytes),p={itag:F.itag,lmt:F.lastModified,xtags:F.xtags},r.push(p);return E.return(r)})},c$p=function(l,y){this.G=l;
this.GD=y},Ohs=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E;
return g.Z(function(u){switch(u.G){case 1:return r=NC(y),g.h(u,lL(l.G,"videoPlaybackPositionEntity"),2);case 2:c=u.K;if(c.length===0)return u.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));g.Im(u,3);return g.h(u,Qq.getInstance(),5);case 5:O=u.K;if(!O)throw Error("prefStorage is undefined");return g.h(u,O.get("psi"),6);case 6:return H=u.K,f=(T=(V=H)==null?void 0:V.wM)!=null?T:"0",g.h(u,eTQ(c,f),7);case 7:return N=u.K,S={isPaused:N.watchHistoryPaused,wM:N.syncTimestampUsec},g.h(u,O.set("psi",
S),8);case 8:if(S.isPaused){u.Ez(9);break}F=g.P(N.frameworkUpdates,WV);if(!N.frameworkUpdates||!F){u.Ez(9);break}return g.h(u,m0J(F),9);case 9:g.qJ(u,4);break;case 3:return p=g.AW(u),E="PPE handleRefresh error: "+(p instanceof Error?p.message:"unknown error"),HV(E),u.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return u.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},VLJ=function(l,y){var r,c,O,H,V,T,f,N;
return g.Z(function(S){switch(S.G){case 1:return r=NC(y),c=g.EX(y.entityKey).entityId,g.Im(S,2),g.h(S,Qq.getInstance(),4);case 4:O=S.K;if(!O)throw Error("prefStorage is undefined");return g.h(S,O.get("psi"),5);case 5:H=S.K;V=g.P(y.actionMetadata,HhI);if(((T=H)==null?void 0:T.isPaused)!==!1||(f=V)==null||!f.lastPlaybackPositionSeconds){S.Ez(6);break}N={key:g.uK(c,"videoPlaybackPositionEntity"),videoId:c,lastPlaybackPositionSeconds:V.lastPlaybackPositionSeconds};return g.h(S,jQ(l.G,N,"videoPlaybackPositionEntity"),
6);case 6:g.qJ(S,3);break;case 2:return g.AW(S),S.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return S.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}})},CUB=function(l,y){var r,c,O;
return g.Z(function(H){switch(H.G){case 1:r=NC(y);g.Im(H,2);c=g.EX(y.entityKey).entityId;if(c==="!*$_ALL_ENTITIES_!*$")return g.h(H,IEJ(l.G),5);O=g.uK(c,"videoPlaybackPositionEntity");return g.h(H,KKp(l.G,O),5);case 5:g.qJ(H,3);break;case 2:return g.AW(H),H.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},glQ=function(l,y){this.api=l;
this.G=y;this.logger=new g.NG("woffle");this.K=!1;this.GT={Is:this.Is};this.logger.debug("Initialized OfflineMediaManager")},TFs=function(l){return g.Z(function(y){return y.return($0j(l))})},fZj=function(l){var y;
return g.Z(function(r){if(r.G==1)return g.h(r,g.c7d(l),2);y=r.K;return r.return(y.filter(function(c){return!!c.url}).map(function(c){return c.url}))})},iL=function(l,y){var r=g.d6(y);
if(r===1||r===0)return Promise.resolve();(r=NFH(l,y))&&r.stopVideo();l.N=0;return TFs(y)},XU=function(l,y,r,c){r=r===void 0?!1:r;
c=c===void 0?!0:c;var O=typeof y==="string"?y:y.videoDetails.videoId;g.d6(O)===2&&((y=NFH(l,O))?y.stopVideo():l.logger.info(function(){return"Corresponding player for "+O+" not found. Pausing anyway"}),g.i1(O,2),l.N=2,r?SqJ(l.G):c&&F$j(l.G))},NFH=function(l,y){var r;
return((r=l.player)==null?void 0:r.getVideoData().videoId)===y?l.player:null},pGJ=function(l,y,r){y.getPlayerResponse();
g.i1(y.videoId,2);l.N=2;l.K=!1;var c;(c=l.player)==null||c.dispose();l.player=l.api.Py(y);y={};l.player.pD((y.localmediachange=l.K0,y.signatureexpired=l.P1,y.statechange=l.WdC,y),l);var O=l.Is(r);l.player.pg(g.N7(O,O,!0,"m"),!1);l.logger.debug(function(){return"Starting headless playback with quality: "+O});
l.player.Nm(!1)},Elg=function(l,y){this.G=l;
this.GD=y},MLj=function(l,y){var r,c;
return g.Z(function(O){switch(O.G){case 1:return r=NC(y),g.h(O,LB(l.G,y.entityKey,"transfer"),2);case 2:if(c=O.K)return O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));g.Im(O,3);return g.h(O,uRs(l,y),5);case 5:g.qJ(O,4);break;case 3:return g.AW(O),O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},aZj=function(l,y){var r,c;
return g.Z(function(O){switch(O.G){case 1:return r=NC(y),g.h(O,LB(l.G,y.entityKey,"transfer"),2);case 2:c=O.K;if(!c||c.transferState!=="TRANSFER_STATE_COMPLETE")return O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));g.Im(O,3);return g.h(O,uRs(l,y,!0),5);case 5:g.qJ(O,4);break;case 3:return g.AW(O),O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}})},scz=function(l,y){var r,c,O,H,V,T,f,N,S,F;
return g.Z(function(p){switch(p.G){case 1:return r=NC(y),c=g.EX(y.entityKey).entityId,g.h(p,kp(l.G,{mode:"readonly",L$:!0},function(E){var u=xp(E,y.entityKey,"transfer");E=xp(E,g.uK(c,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.o$.all([u,E])}),2);
case 2:O=p.K;H=g.a(O);V=H.next().value;T=H.next().value;f=V;N=T;if(!f||f.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return p.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));g.Im(p,3);f.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return g.h(p,jQ(l.G,f,"transfer"),5);case 5:S=g.EX(f.key).entityId;fm({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},{videoId:S,On:f,offlineModeType:(F=N)==null?void 0:F.offlineModeType});g.qJ(p,
4);break;case 3:return g.AW(p),p.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return p.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}})},uRs=function(l,y,r){r=r===void 0?!1:r;
var c,O,H,V,T,f,N,S,F,p,E,u,I,q,W;return g.Z(function(v){switch(v.G){case 1:return c=g.P(y.actionMetadata,K$z),O=g.EX(y.entityKey).entityId,H=g.uK(O,"downloadStatusEntity"),g.h(v,kp(l.G,{mode:"readonly",L$:!0},function(G){var D=xp(G,H,"downloadStatusEntity");G=xp(G,g.uK(O,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.o$.all([D,G])}),2);
case 2:return V=v.K,T=g.a(V),f=T.next().value,N=T.next().value,S=f,F=N,p="TRANSFER_STATE_TRANSFER_IN_QUEUE",((E=S)==null?void 0:E.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(p="TRANSFER_STATE_PAUSED_BY_USER"),q={key:y.entityKey,transferState:p,cotn:g.o1(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(u=c)==null?void 0:u.maximumDownloadQuality,preferredAudioTrack:(I=c)==null?void 0:I.preferredAudioTrack,transferRetryCount:0,isRefresh:r,hasLoggedFirstStarted:!1},g.h(v,kp(l.G,
{mode:"readwrite",L$:!0},function(G){var D=[];r&&D.push(Ra(G,g.uK(O,"offlineVideoStreams")));D.push(bP(G,q,"transfer"));return g.o$.all(D)}),3);
case 3:if(!r){v.Ez(4);break}return g.h(v,TFs(O),4);case 4:fm({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",statusType:"ADDED_TO_QUEUE"},{videoId:O,On:q,offlineModeType:(W=F)==null?void 0:W.offlineModeType}),g.Kl(v)}})},Yqz=function(l,y,r,c){if(!l.action.entityKey)throw Error("entityKey is missing.");
var O=g.EX(l.action.entityKey);O={entityType:O.hs,entityId:O.entityId,offlineOrchestrationActionType:l.action.actionType,orchestrationAction:{orchestrationActionId:l.actionId}};y&&(O.offlineOrchestrationActionResult=y.status,O.isRetryable=r?!1:y.G,y.N&&(O.offlineOrchestrationFailureReason=IZj(y.N,O.isRetryable)));var H,V;if((H=l.action.actionMetadata)==null?0:(V=H.offlineLoggingData)==null?0:V.offlineModeType)O.offlineModeType=l.action.actionMetadata.offlineLoggingData.offlineModeType;c&&(O.additionalOrchestrationActions=
c.map(function(T){return{orchestrationActionId:T.actionId}}));
return O},IZj=function(l,y){return l!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||y?l==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&y?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":l:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},qqx=function(l,y){var r={offlineOrchestrationContext:Yqz(l)};
y=QAH(y,r);wfB(XfJ(),y,l.rootActionId)},A$b=function(l,y,r,c){c=c===void 0?[]:c;
y={offlineOrchestrationContext:Yqz(l,y,r,c)};y=QAH(3,y);wfB(XfJ(),y,l.rootActionId)},W$z=function(){this.actions=[]},mOp=function(l,y){y=g.a(y);
for(var r=y.next();!r.done;r=y.next())r=r.value,qqx(r,1),l.actions.push(r);l.actions.sort(l.G)},vls=function(l,y){if(y)for(var r=0;r<l.actions.length;r++)if(y==="!*$_ALL_ENTITIES_!*$"&&l.actions[r].actionId!==y||y!=="!*$_ALL_ENTITIES_!*$"&&l.actions[r].rootActionId===y&&l.actions[r].actionId!==y)l.actions.splice(r,1),r--},J$H=function(l,y){l=g.a(l.actions);
for(var r=l.next();!r.done;r=l.next())if(r.value.actionId===y)return!0;return!1},QS=function(l,y,r,c,O){g.X.call(this);
var H=this;this.K=l;this.Nf=y;this.Kq=r;this.J=c;this.GD=O;this.G=new W$z;this.L=new g.lf;this.N=new g.yU(function(){H.retry()});
this.W=NaN;this.C=!1;this.GT={Jtr:function(){return H.G},
Ya:function(){return H.L},
F0A:function(){return H.N},
retry:function(){return H.retry()}};
g.Q(this,this.N);this.X=this.K.observe(this.i8.bind(this))},GTJ=function(l,y,r,c,O){var H;
return g.Z(function(V){if(V.G==1)return H=new QS(l,y,r,c,O),g.h(V,olI(H),2);h3z(H);return V.return(H)})},h3z=function(l){var y=l.G.actions[0];
return l.B?((y==null?void 0:y.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&l.B[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(l.C=!0),Promise.resolve()):Zhp(l)},Zhp=function(l){var y,r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W;
return g.Z(function(v){switch(v.G){case 1:if(l.B)throw Error("Already processing an action");if(l.Lq())return v.return();y=l.G.actions.shift();y9p(l.Kq,!y);if(y===void 0)return v.return();y.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&y.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&vls(l.G,y.actionId);r="";y.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&y.rootActionId===y.actionId&&(r=y.actionId);c=[y];l.B=c;if(O=l.Nf[y.entityType]){v.Ez(2);break}l.B=
void 0;return g.h(v,Zhp(l),3);case 3:return v.return();case 2:H=g.a(c);for(V=H.next();!V.done;V=H.next())T=V.value,qqx(T,2);g.Im(v,4,5);return g.h(v,UPx(O,c.map(function(G){return G.action})),7);
case 7:f=v.K,N=g.a(c),S=N.next();case 8:if(S.done){v.Ez(10);break}F=S.value;p=f.get(F.action);return g.h(v,$Ox(l,F,p),9);case 9:S=N.next();v.Ez(8);break;case 10:vls(l.G,r);case 5:g.Wz(v);l.B=void 0;g.m3(v,6);break;case 4:return E=g.AW(v),HV("Orchestration error",E),g.Im(v,12),g.h(v,BFp(l,c),14);case 14:g.qJ(v,5);break;case 12:u=g.AW(v);HV("Orchestration retry error",u);I=g.a(c);for(q=I.next();!q.done;q=I.next())W=q.value,W.retryScheduleIndex<3&&mOp(l.G,[W]);v.Ez(5);break;case 6:return g.h(v,Zhp(l),
0)}})},$Ox=function(l,y,r){var c,O,H,V,T,f,N,S,F,p,E,u;
return g.Z(function(I){switch(I.G){case 1:c=y.retryScheduleIndex+2===3;if(r.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){I.Ez(2);break}if(r.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){I.Ez(0);break}A$b(y,r,c);if(r.G&&y.retryScheduleIndex+1<3)return g.h(I,BFp(l,[y]),0);H=((O=r)==null?0:O.K)?r.K:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";V={entityKey:y.action.entityKey,failureReason:H};T=void 0;g.O8(l.GD)?T="mainVideoDownloadStateEntity":g.bD(l.GD)&&(T="musicTrackDownloadMetadataEntity");
if(!T||!r.downloadState){I.Ez(7);break}f=g.EX(y.action.entityKey).entityId;return g.h(I,E$(f,T,l.K,r.downloadState),7);case 7:Cm(l.J,V);if(r.downloadState==="DOWNLOAD_STATE_FAILED"&&l.GD.j("html5_auto_retry_failed_pde_actions")){I.Ez(0);break}HV("Orchestration result is not retryable, deleting action");return g.h(I,KKp(l.K,I6(y).key),0);case 2:N=void 0;try{N=(S=r.B)==null?void 0:S.map(function(q){return l.createAction(q,y)})}catch(q){return A$b(y,r,c),F={entityKey:y.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Cm(l.J,F),HV("Orchestration subactions creation error",q),I.return()}A$b(y,r,c,N);if(!N){I.Ez(12);break}p=N.map(function(q){return I6(q)});
E=0;case 13:if(!(E<N.length)||l.C){I.Ez(15);break}return g.h(I,kp(l.K,{mode:"readwrite",L$:!0},function(q){var W=[];W.push(fEJ(q,p.slice(E,E+10),"offlineOrchestrationActionWrapperEntity"));return g.o$.all(W)}),16);
case 16:E+=10;I.Ez(13);break;case 15:if(l.C)return l.C=!1,I.return();case 12:return u=I6(y),g.h(I,KKp(l.K,u.key),17);case 17:qqx(y,4),g.Kl(I)}})},ihg=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E;
return g.Z(function(u){r=[];c=Infinity;O=4E3;H=g.a(y);for(V=H.next();!V.done;V=H.next())T=V.value,f=Number(T.enqueueTimeSec),N=tLj(f),S=T.retryScheduleIndex,F=S!=null&&S>0,N>0&&F?(c=Math.min(c,f),O=Math.min(N,O)):r.push(T);isFinite(c)&&(!l.N.isActive()||c<l.W)&&(l.W=c,l.N.start(O));l.L.kR()||(p=r.length,r=r.filter(function(I){var q;I=((q=I.actionProto)==null?void 0:q.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!DOb.includes(I)}),E=r.length<p,!l.N.isActive()&&E&&l.N.start(1));
r.length>0&&dOz(l,r);return g.h(u,h3z(l),0)})},Qcj=function(l){var y,r,c,O,H,V,T;
return g.Z(function(f){if(f.G==1)return g.h(f,XGH(l),2);y=f.K;r=[];c=g.a(y);for(O=c.next();!O.done;O=c.next())H=O.value,V=g.EX(H.key),T=V.entityId,J$H(l.G,T)||r.push(H);return g.h(f,ihg(l,r),0)})},tLj=function(l){l=l*1E3-Date.now();
return l>4E3?4E3:l},BFp=function(l,y){var r,c,O;
return g.Z(function(H){r=g.a(y);for(c=r.next();!c.done;c=r.next()){O=c.value;var V=void 0,T=void 0,f=((T=O.action)==null?void 0:(V=T.actionMetadata)==null?void 0:V.retryScheduleIntervalsInSeconds)||[1,2,4];V=1;O.retryScheduleIndex<f.length&&(V=f[O.retryScheduleIndex]);O.G=V*1E3+Date.now();O.retryScheduleIndex++}return g.h(H,wGJ(l,y),0)})},olI=function(l){var y;
return g.Z(function(r){if(r.G==1)return g.h(r,lL(l.K,"offlineOrchestrationActionWrapperEntity"),2);y=r.K;return g.h(r,ihg(l,y),0)})},dOz=function(l,y){y.length!==0&&y.forEach(function(r){r=Km(r);
r.retryScheduleIndex<3&&mOp(l.G,[r])})},XGH=function(l,y){var r;
return g.Z(function(c){if(c.G==1)return g.h(c,lL(l.K,"offlineOrchestrationActionWrapperEntity",y),2);r=c.K;return c.return(r.filter(vis))})},wGJ=function(l,y){if(y.length===0)return Promise.resolve([]);
y=y.map(function(r){return I6(r)});
return sAJ(l.K,y)},PUg=function(l){this.fq=l;
this.G=void 0},xOg=function(l,y){var r,c,O,H;
return g.Z(function(V){r=y.videoId;c=!0;if(y.captionTracks.length)O=V0H(y),l.G=new g.AK(l.fq,y,O);else if(y.rY)H=g.Siv(y),l.G=new g.mV(l.fq,y.rY,r,H,y.Ru,y.eventId),c=y.Ru;else return V.return();return V.return(new Promise(function(T){var f;(f=l.G)==null||f.v2({WA:function(){return g.Z(function(N){if(N.G==1)return g.h(N,l.WA(r,c),2);T();g.Kl(N)})},
PW:function(){}})}))})},e3s=function(l){var y;
return g.Z(function(r){if(r.G==1)return g.h(r,Zds(l),2);y=r.K;return r.return(!!y&&y.length>0)})},wI=function(l){g.X.call(this);
this.G=l;this.K=this.G.observe(this.N.bind(this))},nlJ=function(l,y){var r,c,O,H,V,T,f;
return g.Z(function(N){switch(N.G){case 1:if(y.length===0)return N.return([]);r=y.map(function(S){return g.uK(S,"transfer")});
return g.h(N,lL(l.G,"transfer",r),2);case 2:c=N.K;O=c.filter(vis).map(function(S){return g.EX(S.key).entityId});
H=y.filter(function(S){return O.indexOf(S)===-1});
if(H.length===0)return N.return([]);V=g.a(H);T=V.next();case 3:if(T.done){N.Ez(5);break}f=T.value;return g.h(N,TFs(f),4);case 4:T=V.next();N.Ez(3);break;case 5:return N.return(H)}})},UOg=function(l,y,r,c,O,H){var V,T,f;
return g.Z(function(N){V="STREAM_TYPE_UNKNOWN";r.video&&r.audio?(V="STREAM_TYPE_AUDIO_AND_VIDEO",HV("unexpected stream type")):r.video&&!r.audio?V="STREAM_TYPE_VIDEO":!r.video&&r.audio&&(V="STREAM_TYPE_AUDIO");T=g.uK(y,"offlineVideoStreams");f={numBytesDownloaded:O.toFixed(),numTotalBytes:H.toFixed(),streamType:V,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(c),itag:V==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(r.itag):void 0};return g.h(N,kp(l,{mode:"readwrite",L$:!0},
function(S){var F=xp(S,T,"offlineVideoStreams"),p=xp(S,g.uK(y,"transfer"),"transfer");return g.o$.all([F,p]).then(function(E){E=g.a(E);var u=E.next().value;E=E.next().value;if(!E)return Ra(S,T).then(function(){});
var I=bhJ(u);u=R3j(u,c,f,T);var q=bP(S,u,"offlineVideoStreams");bhJ(u)>I&&(E.lastProgressTimeMs=Date.now().toString());I=[q];E.offlineVideoStreams||(E.offlineVideoStreams=[]);E.offlineVideoStreams.indexOf(T)===-1&&(E.offlineVideoStreams.push(T),I.push(bP(S,E,"transfer")));return g.o$.all(I)})}),0)})},z3p=function(l,y){var r,c,O,H,V;
return g.Z(function(T){if(T.G==1)return r=g.uK(y,"offlineVideoStreams"),g.h(T,LB(l,r,"offlineVideoStreams"),2);c=T.K;if(!c||!c.streamsProgress)return T.return();O=g.a(c.streamsProgress);for(H=O.next();!H.done;H=O.next())V=H.value,V.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",V.numTotalBytes!==V.numBytesDownloaded&&(V.numBytesDownloaded=V.numTotalBytes);return g.h(T,jQ(l,c,"offlineVideoStreams"),0)})},R3j=function(l,y,r,c){if(l&&l.streamsProgress){c=l;
a:{y=y.itag+";"+y.xtags;for(var O=l.streamsProgress,H=0;H<O.length;H++){var V=JSON.parse(O[H].formatStreamBytes);if(V.itag+";"+V.xtags===y){O[H]=r;r=O;break a}}O.push(r);r=O}c.streamsProgress=r}else l={key:c,streamsProgress:[r]};return l},bhJ=function(l){if(l==null?0:l.streamsProgress){var y=0;
l=l.streamsProgress;for(var r=0;r<l.length;r++){var c=l[r];isNaN(Number(c.numBytesDownloaded))?HV("stream progress bytes number invalid"):y+=Number(c.numBytesDownloaded)}return y}return 0},kTj=function(l,y,r,c){g.X.call(this);
var O=this;this.K=l;this.api=y;this.ZZ=r;this.i8=c;this.L=new g.lf;this.B=new g.yU(function(){O.G&&O.G.transferState==="TRANSFER_STATE_TRANSFERRING"&&O.L.kR()&&((O.G.transferRetryCount||0)<3?XU(O.J,O.C,!1,!1):iL(O.J,O.C.videoDetails.videoId),O.V_("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.Kq=this.Mf=0;this.X=this.W=!1;this.Sj=g.Ib(this.api.D().experiments,"html5_transfer_processing_logs_interval");this.r9=new g.n4(this);this.GT={HLz:function(){return O.B},
CsI:function(){return O.i8},
Ya:function(){return O.L}};
this.Nf=this.K.observe(this.EJ.bind(this));this.J=new glQ(y,this);this.qf=new PUg(y);this.Uz=new wI(this.K);this.Cq=this.L.listen("publicytnetworkstatus-online",this.Yb.bind(this));this.II=this.L.listen("publicytnetworkstatus-offline",this.OUw.bind(this));this.X=this.api.D().j("html5_less_transfer_processing_logs");g.Q(this,this.r9);this.r9.S(y,"offlinetransferpause",this.yQZ);g.O8(this.api.D())?this.N="mainVideoDownloadStateEntity":g.bD(this.api.D())&&(this.N="musicTrackDownloadMetadataEntity")},
jcg=function(l){return g.Z(function(y){if(y.G==1)y=g.h(y,hNp(),2);
else{var r=l.Uz;var c=g.Ds();c=Object.keys(c);r=nlJ(r,c);y=g.h(y,r,0)}return y})},x6=function(l,y){y=y===void 0?!1:y;
var r;return g.Z(function(c){if(c.G==1){if(l.G)throw Error("Already downloading a video");l.Kq=0;l.W=!1;return g.h(c,L$B(l),2)}return c.G!=4?(r=c.K,r9J(l.ZZ,!r),r&&l.L.kR()?y?g.h(c,new Promise(function(O){g.Kz(O,1E3)}),4):c.Ez(4):(!r&&l.G&&PV(l),c.Ez(0))):g.h(c,laJ(l,r),0)})},y4B=function(l){return g.Z(function(y){if(y.G==1)return l.C?g.h(y,iL(l.J,l.C.videoDetails.videoId),3):y.Ez(0);
PV(l);g.Kl(y)})},r4B=function(l,y){var r,c,O;
return g.Z(function(H){switch(H.G){case 1:return g.Im(H,2),(r=!!y.captionTracks.length||!!y.rY)?g.h(H,e3s(y.videoId),4):H.return();case 4:return(c=H.K)?H.return():g.h(H,xOg(l.qf,y),5);case 5:g.qJ(H,0);break;case 2:O=g.AW(H),HV("Caption downloading error",O,y.cotn),g.Kl(H)}})},laJ=function(l,y){var r,c,O,H,V,T;
return g.Z(function(f){switch(f.G){case 1:if(l.W)return f.return();l.W=!0;l.G=y;r=g.EX(l.G.key);c=r.entityId;O=void 0;if(l.G.transferState==="TRANSFER_STATE_TRANSFERRING")return g.h(f,e3(l,c),7);if(l.G.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||l.G.transferRetryCount||l.G.hasLoggedFirstStarted){f.Ez(3);break}return g.h(f,e3(l,c),5);case 5:return O=f.K,l.G.hasLoggedFirstStarted=!0,g.h(f,c4H(l),6);case 6:c9J({videoId:c,On:l.G,offlineModeType:O},void 0,void 0,!0);f.Ez(3);break;case 7:O=f.K,
fm({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",statusType:"OFFLINING_RETRIED"},{videoId:c,On:l.G,offlineModeType:O});case 3:return g.h(f,OUQ(l),8);case 8:return H=null,g.Im(f,9),g.h(f,HUg(l,y),11);case 11:H=f.K;l.C=H;g.qJ(f,10);break;case 9:return V=g.AW(f),HV("error getting player response",V,y.cotn),g.h(f,l.V_("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return f.return();case 10:return T=Tnb(l.api.D(),y.cotn,H),g.h(f,r4B(l,T),13);case 13:return g.h(f,fZj(T.videoId),
14);case 14:T.Ti=f.K,pGJ(l.J,T,y.maximumDownloadQuality),l.B.start(108E5),g.Kl(f)}})},L$B=function(l){var y,r;
return g.Z(function(c){if(c.G==1)return g.h(c,lL(l.K,"transfer"),2);y=c.K;r=y.filter(VyH).sort(CaH);return r.length===0?c.return():c.return(r[0])})},OUQ=function(l){var y,r,c;
return g.Z(function(O){if(O.G==1){if(!l.G)return nm(l,"onTransferStart"),O.return();l.B.start(108E5);return g.h(O,bL(l,"TRANSFER_STATE_TRANSFERRING"),2)}y=l.G;return(c=((r=y)==null?0:r.key)?g.EX(y.key).entityId:"")&&l.N?g.h(O,E$(c,l.N,l.K,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):O.Ez(0)})},SqJ=function(l){var y,r,c,O;
g.Z(function(H){switch(H.G){case 1:if(!l.G){nm(l,"onTransferPausedByUser");H.Ez(2);break}y=l.G;l.B.stop();return g.h(H,bL(l,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:c=((r=y)==null?0:r.key)?g.EX(y.key).entityId:"";if(!c||!l.N){H.Ez(4);break}return g.h(H,E$(c,l.N,l.K,"DOWNLOAD_STATE_PAUSED"),4);case 4:return g.h(H,e3(l,c),6);case 6:O=H.K,Oog({videoId:c,On:y,offlineModeType:O});case 2:PV(l),x6(l),g.Kl(H)}})},F$j=function(l){var y,r,c;
g.Z(function(O){if(O.G==1){if(!l.G)return nm(l,"onTransferPausedByNetwork"),O.return();l.B.stop();return g.h(O,bL(l,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(O.G!=3)return y=l.G,(c=((r=y)==null?0:r.key)?g.EX(y.key).entityId:"")&&l.N?g.h(O,E$(c,l.N,l.K,"DOWNLOAD_STATE_PAUSED"),3):O.Ez(3);PV(l);g.Kl(O)})},ggJ=function(l){var y,r,c,O,H;
g.Z(function(V){switch(V.G){case 1:if(!l.G)return nm(l,"onTransferComplete"),V.return();y=l.G;l.B.stop();if(!y||!l.C){V.Ez(2);break}r=Tnb(l.api.D(),y.cotn,l.C);return g.h(V,r4B(l,r),2);case 2:return g.h(V,bL(l,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:O=((c=y)==null?0:c.key)?g.EX(y.key).entityId:"";if(!O||!l.N){V.Ez(5);break}return g.h(V,E$(O,l.N,l.K,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return g.h(V,z3p(l.K,O),7);case 7:return g.h(V,e3(l,O),8);case 8:H=V.K,fm({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:O,On:y,offlineModeType:H}),PV(l),x6(l),g.Kl(V)}})},TDJ=function(l,y,r){var c,O;
g.Z(function(H){switch(H.G){case 1:if(!l.G)return nm(l,"onTransferProgress: "+y),H.return();if(l.G.transferState==="TRANSFER_STATE_TRANSFERRING"){H.Ez(2);break}return g.h(H,OUQ(l),2);case 2:c=Date.now();if(!(c-l.Mf>1E3)){H.Ez(4);break}l.Mf=c;return g.h(H,UOg(l.K,r.videoId,r.K,r.OW,r.bytesDownloaded,r.G),5);case 5:if(l.X&&!(l.X&&c-l.Kq>l.Sj)){H.Ez(4);break}l.Kq=c;return g.h(H,e3(l,y),7);case 7:O=H.K,c9J({videoId:y,On:l.G,offlineModeType:O},r.bytesDownloaded,r.G);case 4:l.B.start(108E5),g.Kl(H)}})},
fag=function(l){var y=(l.G.transferRetryCount||0)<3;
y&&(l=l.G,l.transferRetryCount=(l.transferRetryCount||0)+1);return y},NDJ=function(l,y){y=y===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":y;
var r,c,O,H;return g.Z(function(V){if(V.G==1)return l.G||nm(l,"setTransferToFailed: "+y),r="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",y==="TRANSFER_FAILURE_REASON_NETWORK"?r="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":y==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(r="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),g.h(V,bL(l,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",y),2);if(V.G!=3)return Cm(l.i8,{entityKey:(c=l.G)==null?void 0:c.key,failureReason:r}),
O=l.G?g.EX(l.G.key).entityId:"",g.h(V,e3(l,O),3);H=V.K;var T={videoId:O,On:l.G,offlineModeType:H},f=y,N={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};f&&(N.transferFailureReason=f,N.failureReason=HoJ(f));fm(N,T);g.Kl(V)})},bL=function(l,y,r,c){var O;
return g.Z(function(H){if(H.G==1){if(!l.G)return nm(l,"saveTransferState: "+y),H.return();l.G.transferState=y;l.G.failureReason=c;g.Im(H,2);return g.h(H,c4H(l,function(V){return r?eQ(V,"offlineVideoStreams",l.G.offlineVideoStreams).then(function(T){for(var f=g.a(T),N=f.next();!N.done;N=f.next())if((N=N.value)&&N.streamsProgress){N=g.a(N.streamsProgress);for(var S=N.next();!S.done;S=N.next())S.value.streamState=r}return fEJ(V,T.filter(function(F){return!!F}),"offlineVideoStreams")}):g.o$.resolve(void 0)}),
4)}if(H.G!=2)return g.qJ(H,0);
O=g.AW(H);return O instanceof g.Y$&&O.type==="QUOTA_EXCEEDED"?g.h(H,l.V_("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):H.Ez(0)})},c4H=function(l,y){var r;
return g.Z(function(c){if(!l.G)return c.return();r=l.G;return g.h(c,kp(l.K,{mode:"readwrite",L$:!0},function(O){var H=[bP(O,r,"transfer")];y&&H.push(y(O));return g.o$.all(H)}),0)})},PV=function(l){l.G=void 0;
l.C=void 0;l.B.stop()},HUg=function(l,y){var r,c,O,H,V;
return g.Z(function(T){if(T.G==1)return r=g.EX(y.key),c=r.entityId,O=g.uK(c,"playbackData"),g.h(T,LB(l.K,O,"playbackData"),2);H=T.K;if((V=H)==null?0:V.playerResponseJson)return T.return(JSON.parse(H.playerResponseJson));throw Error("No PlayerResponse found");})},nm=function(l,y){l.api.AC("woffle",{mcte:y});
HV("missing current transfer entity.")},e3=function(l,y){var r,c,O;
return g.Z(function(H){if(H.G==1)return g.h(H,LB(l.K,g.uK(y,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);r=H.K;return H.return((O=(c=r)==null?void 0:c.offlineModeType)!=null?O:void 0)})},VyH=function(l){return SrJ[l.transferState]!==void 0},CaH=function(l,y){var r=SrJ[l.transferState],c=SrJ[y.transferState];
return r!==c?r-c:Number(l.enqueuedTimestampMs)-Number(y.enqueuedTimestampMs)},R6=function(l,y){var r=this;
this.GD=l;this.api=y;this.L=new g.lf;this.C=new g.sy;this.GT={v9:function(){return r.N.GT.v9()},
Ya:function(){return r.L},
L0C:function(){return r.N},
Fz:function(){return r.Fz()},
Gu:function(){return r.Gu()},
KE:function(){return r.KE()},
UV:function(){return r.UV()},
dP:function(){return r.dP()},
qx:function(c){return r.qx(c)}};
this.N=new jAJ(function(){return F1I(r)},function(){r.KE()},this.api.LR(),this.api.j.bind(this.api));
this.G=new VS(this.api);LKH(this.N)},F1I=function(l){return g.Z(function(y){l.api.HT("onOrchestrationBecameLeader");
return g.h(y,l.Gu(),0)})},Egj=function(l){var y,r;
return g.Z(function(c){if(c.G==1)return g.h(c,yS(),2);if(c.G!=3){y=c.K;if(!y)return HV("PES is undefined"),c.return();l.K=new kTj(y,l.api,l.N,l.G);r=l.Zb(y);return g.h(c,GTJ(y,r,l.N,l.G,l.GD),3)}l.J=c.K;return g.h(c,p6J(l),0)})},p6J=function(l){var y;
return g.Z(function(r){switch(r.G){case 1:if(!l.K)return HV("transferManager is undefined"),r.return();if(l.K.G){r.Ez(2);break}return g.h(r,x6(l.K),2);case 2:if(!l.GD.j("woffle_enable_main_downloads_library")){r.Ez(4);break}return g.h(r,l.Ac(),4);case 4:if(!l.GD.j("html5_offline_playback_position_sync")){r.Ez(6);break}return g.h(r,l.Vw(),7);case 7:return g.h(r,l.qx(864E5),6);case 6:return g.h(r,l.refreshAllStaleEntities(43200,!0),9);case 9:return g.h(r,l.yC(),10);case 10:if(!l.GD.j("html5_retry_downloads_for_expiration")){r.Ez(11);
break}return g.h(r,l.dP(),11);case 11:return l.W=g.Iq(function(){l.refreshAllStaleEntities(43200,!0);l.yC()},9E5),g.OE(g.VF(),function(){return l.UV()}),g.h(r,yS(),13);
case 13:return y=r.K,g.h(r,kmz(y),14);case 14:lNj(l.N),g.Kl(r)}})},ubg=function(){var l,y,r,c,O,H;
return g.Z(function(V){switch(V.G){case 1:return g.h(V,yS(),2);case 2:l=V.K;if(!l)return V.return([]);y=Date.now()/1E3;return g.h(V,lL(l,"offlineVideoPolicy"),3);case 3:r=V.K,c=g.a(r),O=c.next();case 4:if(O.done){V.Ez(6);break}H=O.value;if(!(H.expirationTimestamp&&Number(H.expirationTimestamp)<y)){V.Ez(5);break}H.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";H.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return g.h(V,jQ(l,H,"offlineVideoPolicy"),5);
case 5:O=c.next();V.Ez(4);break;case 6:return V.return(r.map(function(T){return T.key}))}})},U$=function(l,y,r,c,O){var H,V,T;
return g.Z(function(f){if(f.G==1)return g.h(f,yS(),2);H=f.K;if(!H)return f.return([]);V=y.map(function(N){var S=g.uK(N,r);S={actionType:c,entityKey:S,actionMetadata:Object.assign({},fNB(),O)};c!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(S.actionMetadata.priority=0);N=new s$(r,N,S);return I6(N)});
T=sAJ(H,V);LKH(l.N);return f.return(T)})},Myj=function(l,y,r,c){var O,H,V,T,f,N,S,F;
return g.Z(function(p){switch(p.G){case 1:O=[],H=g.a(y),V=H.next();case 2:if(V.done){p.Ez(4);break}T=V.value;if(T.upToDate||r&&!T.shouldAutoSyncMetadata||!T.playlistId){p.Ez(3);break}f={};switch(c){case "mainPlaylistEntity":N={nextAutoRefreshIntervalSeconds:T.checkInSeconds,autoSync:r};f={mainPlaylistEntityActionMetadata:N};break;case "musicPlaylist":S={autoSync:r},f={musicPlaylistEntityActionMetadata:S}}return g.h(p,U$(l,[T.playlistId],c,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",f),6);case 6:(F=
p.K)&&O.push.apply(O,g.Y(F));case 3:V=H.next();p.Ez(2);break;case 4:return p.return(O)}})},aaj=function(l,y){var r;
return g.Z(function(c){return y.length?(r=fNB(),g.Rn(r,Dj,{isEnqueuedForExpiredStreamUrlRefetch:!0}),l.api.AC("qrd",{v:y.length}),c.return(U$(l,y,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",r))):c.return([])})},sVx=function(l,y,r){this.G=l;
this.GD=y;this.N=r},Yrs=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W,v;
return g.Z(function(G){switch(G.G){case 1:return r=NC(y),c=g.EX(y.entityKey),O=c.entityId,H=[],g.Im(G,2),g.h(G,K1H(l,O),4);case 4:H=G.K;if(!(l.GD.j("woffle_enable_main_downloads_library")&&((V=H)==null?0:V.length))){G.Ez(5);break}return g.h(G,qmz(l.G,[y.entityKey]),5);case 5:g.qJ(G,3);break;case 2:return T=g.AW(G),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.Y$&&T.type==="QUOTA_EXCEEDED"?(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):HV("Playlist add error"),G.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,f,N));case 3:S=[];if(!l.GD.j("html5_offline_prevent_redownload_downloaded_video")){G.Ez(7);break}return g.h(G,gXH(l.G,"mainVideoEntity",H),8);case 8:H=G.K;case 7:if((F=H)==null?0:F.length)for(p=g.a(H),E=p.next();!E.done;E=p.next())if(u=E.value,I=u.offlineVideoData,q=void 0,(q=I)==null?0:q.videoId)W=void 0,v=Number(((W=y.actionMetadata)==null?void 0:W.priority)||
0)+1,S.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",I.videoId,"mainVideoEntity",v,z0,IaB(y,I,O)));return G.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,S))}})},A4j=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl,ls,x,L,K,e,Xv,Ig,FQ,vz,jC,Hx,uj,A,m,J,B,d,yN,Hz,VN,t,NJ,MJ,TZ,GZ,pp,ij,Fw,eC,Xw,gc,Z0,xT,fH,x_,QK,e4,se,No,Jy,FJ,oL,BX,tn,Av,j9,ng,cI,A$,XP;
return g.Z(function(pM){switch(pM.G){case 1:return r=NC(y),c=y.entityKey,O=g.EX(c).entityId,H=[],V=!1,O==="!*$_ALL_ENTITIES_!*$"?(V=!0,g.h(pM,lL(l.G,"mainPlaylistEntity"),5)):g.h(pM,LB(l.G,c,"mainPlaylistEntity"),4);case 4:(T=pM.K)&&H.push(T);pM.Ez(3);break;case 5:H=pM.K;case 3:if((f=H)==null||!f.length)return pM.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));N=g.P(y.actionMetadata,qrI);F=(S=N)==null?void 0:S.nextAutoRefreshIntervalSeconds;E=(p=N)==null?void 0:p.autoSync;u=[];q=I=
!0;W=!1;if(!V&&E===!1){pM.Ez(6);break}g.Im(pM,7);return g.h(pM,dPj(0,!!E,!0,H),9);case 9:u=pM.K;g.qJ(pM,8);break;case 7:v=g.AW(pM);if(!(v instanceof Error&&v.message==="No data")){v instanceof Error&&v.message==="Empty response body"&&HV(v.message);pM.Ez(8);break}return O==="!*$_ALL_ENTITIES_!*$"?g.h(pM,Mfb(l.G,y,l.N,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):g.h(pM,EXQ(O,l.G,y,l.N),8);case 8:if(!u.length||!V&&u[0].playlistId!==O)return pM.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r));case 6:if(V){G=[];D=g.a(u);for(w=D.next();!w.done;w=D.next())U=w.value,U.upToDate||E&&!U.shouldAutoSyncMetadata||!U.playlistId||(R={nextAutoRefreshIntervalSeconds:U.checkInSeconds,autoSync:E},G.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",U.playlistId,"mainPlaylistEntity",0,z0,{mainPlaylistEntityActionMetadata:R})));return pM.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,G))}u.length&&(ON=u[0],W=!!ON.upToDate,E&&(I=(Cl=ON.shouldAutoSyncMetadata)!=null?Cl:!0,q=(ls=ON.shouldAutoSyncVideos)!=
null?ls:!0,ON.checkInSeconds&&(F=ON.checkInSeconds)));if(W||!I)return pM.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));x=[];L=H[0];if(!L.downloadState){K=void 0;pM.Ez(15);break}return g.h(pM,LB(l.G,L.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:K=pM.K;case 15:return e=K,Ig=((Xv=e)==null?0:Xv.addedTimestampMillis)?String(e.addedTimestampMillis):void 0,g.Im(pM,17),g.h(pM,K1H(l,O,Ig,F),19);case 19:x=pM.K;g.qJ(pM,18);break;case 17:FQ=g.AW(pM);if(!(FQ instanceof Error&&
FQ.message==="No data for playlist")){if(FQ instanceof Error&&FQ.message==="Empty response body for playlist")HV(FQ.message);else return vz="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",jC="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",FQ instanceof g.Y$&&FQ.type==="QUOTA_EXCEEDED"&&(vz="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",jC="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),pM.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,vz,jC));pM.Ez(18);
break}return g.h(pM,EXQ(O,l.G,y,l.N),18);case 18:if(!q)return pM.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));Hx=[];uj=new Map;if((A=x)==null?0:A.length)for(m=g.a(x),J=m.next();!J.done;J=m.next())B=J.value,d=B.offlineVideoData,yN=void 0,((yN=d)==null?0:yN.videoId)&&uj.set(d.videoId,d);Hz=new Map;VN=[];if((t=L)==null?0:(NJ=t.videos)==null?0:NJ.length)for(MJ=g.a(L.videos),TZ=MJ.next();!TZ.done;TZ=MJ.next())if(GZ=TZ.value,pp=JSON.parse(g.EX(GZ).entityId),ij=pp.videoId)uj.has(ij)?(Hz.set(ij,
uj.get(ij)),uj.delete(ij)):VN.push(ij);eC=Number(((Fw=y.actionMetadata)==null?void 0:Fw.priority)||0)+1;Xw=g.a(uj.entries());for(gc=Xw.next();!gc.done;gc=Xw.next())Z0=gc.value,xT=g.a(Z0),fH=xT.next().value,x_=xT.next().value,QK=fH,e4=x_,Hx.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",QK,"mainVideoEntity",eC,z0,IaB(y,e4,O)));se=g.a(Hz.entries());for(No=se.next();!No.done;No=se.next())Jy=No.value,FJ=g.a(Jy),oL=FJ.next().value,BX=FJ.next().value,tn=oL,Av=BX,Hx.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
tn,"mainVideoEntity",eC,z0,IaB(y,Av,O)));j9=g.a(VN);for(ng=j9.next();!ng.done;ng=j9.next())cI=ng.value,A$={playlistId:O},XP={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:A$},Hx.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",cI,"mainVideoEntity",0,z0,XP));return pM.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,Hx))}})},W1g=function(l,y){var r,c,O,H;
return g.Z(function(V){switch(V.G){case 1:return r=NC(y),g.Im(V,2),c=g.EX(y.entityKey).entityId,c==="!*$_ALL_ENTITIES_!*$"?g.h(V,Mfb(l.G,y,l.N,(O=y.actionMetadata)==null?void 0:(H=O.offlineLoggingData)==null?void 0:H.offlineDeleteReason),5):g.h(V,EXQ(c,l.G,y,l.N),6);case 6:if(!l.GD.j("woffle_enable_main_downloads_library")){V.Ez(5);break}return g.h(V,A9J(l.G,y.entityKey),5);case 5:g.qJ(V,3);break;case 2:return g.AW(V),V.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return V.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}})},K1H=function(l,y,r,c){var O,H,V,T,f,N,S;
return g.Z(function(F){switch(F.G){case 1:return g.h(F,tfb([y]),2);case 2:return O=F.K,g.h(F,mrz(l,O[0],r,c),3);case 3:return H=F.K,V=H.mainPlaylistEntity,T=H.UtA,N=FOp(V,(f=T)==null?void 0:f.avatar),g.Im(F,4),g.h(F,qC(N),6);case 6:g.qJ(F,5);break;case 4:S=g.AW(F),S instanceof Error&&S.message==="Failed to fetch"&&HV(S.message);case 5:return F.return(O[0].videos)}})},mrz=function(l,y,r,c){var O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D;
return g.Z(function(w){switch(w.G){case 1:O=Date.now().toString();r||(r=O);H=y.videos;V=y.playlistId;T=[];f=[];if(H)for(N=g.a(H),S=N.next();!S.done;S=N.next()){F=S.value;p=F.offlineVideoData;if(!p||!p.videoId)throw HV("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");E=p.videoId;u={videoId:E,playlistId:V};I={id:g.uK(JSON.stringify(u),"mainPlaylistVideoEntity"),video:g.uK(E,"mainVideoEntity")};T.push(I);f.push(I.id)}W={key:g.uK(V,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:r,lastSyncedTimestampMillis:O};v={key:g.uK(V,"mainPlaylistEntity"),playlistId:V,videos:f,title:y.title,thumbnailStyleData:vgI(y),visibility:J4s(y),downloadState:W.key};y.channel&&(G=y.channel.offlineChannelData,q=ogB(g.uK(V,"ytMainChannelEntity"),G),v.channelOwner=q.id);((D=v)==null?0:D.entityMetadata)?(v.entityMetadata.offlineLastModifiedTimestampSeconds=y.lastModifiedTimestamp,c&&(v.entityMetadata.nextAutoRefreshIntervalSeconds=String(c))):v&&(v.entityMetadata={nextAutoRefreshIntervalSeconds:c?
String(c):void 0,offlineLastModifiedTimestampSeconds:y.lastModifiedTimestamp});g.Im(w,2);return g.h(w,kp(l.G,{mode:"readwrite",L$:!0},function(U){var R=bP(U,v,"mainPlaylistEntity"),ON=bP(U,W,"mainPlaylistDownloadStateEntity");R=[R,ON];ON=g.a(T);for(var Cl=ON.next();!Cl.done;Cl=ON.next())R.push(bP(U,Cl.value,"mainPlaylistVideoEntity"));q&&R.push(bP(U,q,"ytMainChannelEntity"));return g.o$.all(R)}),4);
case 4:g.qJ(w,3);break;case 2:throw g.AW(w),HV("PES failure for playlist"),Error("PES failure for playlist");case 3:return w.return({mainPlaylistEntity:v,UtA:q,zBq:T})}})},ogB=function(l,y){return{id:l,
channelId:y.channelId,title:y.title,avatar:y.thumbnail}},vgI=function(l){var y=[],r=l.videos;
r&&r.length>0&&y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:r[0].offlineVideoData.thumbnail}}});if((l=l.additionalMetadadatas)&&l.length>0)for(l=g.a(l),r=l.next();!r.done;r=l.next()){var c=r.value.offlineBundleItemPlaylistData,O=void 0;r=(O=c)==null?void 0:O.style;O=void 0;c={collageThumbnail:{coverThumbnail:(O=c)==null?void 0:O.coverThumbnail}};switch(r){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:c});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:c});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:c});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":y.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:c})}}return y},J4s=function(l){switch(l.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},IaB=function(l,y,r){y={offlineVideoData:y,
playlistId:r};if(l=g.P(l.actionMetadata,qrI))y.maximumDownloadQuality=l.maximumDownloadQuality;return{mainVideoEntityActionMetadata:y}},hoj=function(l,y,r){this.G=l;
this.GD=y;this.N=r},$rJ=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u;
return g.Z(function(I){switch(I.G){case 1:return r=NC(y),c=g.EX(y.entityKey),O=c.entityId,H=g.P(y.actionMetadata,k6),T=!((V=H)==null?0:V.playlistId),g.Im(I,2),g.h(I,GHp(l,O,void 0,(f=H)==null?void 0:f.offlineVideoData,T),4);case 4:g.qJ(I,3);break;case 2:return N=g.AW(I),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.Y$&&N.type==="QUOTA_EXCEEDED"&&(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
I.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,S,F));case 3:p=1;p=Number(((E=y.actionMetadata)==null?void 0:E.priority)||0)+1;var q=(q=g.P(y.actionMetadata,k6))?{playbackDataActionMetadata:{maximumDownloadQuality:q.maximumDownloadQuality}}:void 0;u=BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O,"playbackData",p,ZUs,q);return I.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,[u]))}})},BDz=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W,v;
return g.Z(function(G){switch(G.G){case 1:return r=NC(y),c=g.EX(y.entityKey),O=c.entityId,g.h(G,LB(l.G,y.entityKey,"mainVideoEntity"),2);case 2:H=G.K;if(!H){V=void 0;G.Ez(3);break}return g.h(G,LB(l.G,H.downloadState,"mainVideoDownloadStateEntity"),4);case 4:V=G.K;case 3:T=V;if(!H||!T)return G.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));g.Im(G,5);return g.h(G,GHp(l,O,T.addedTimestampMillis,(N=g.P(y.actionMetadata,k6))==null?void 0:N.offlineVideoData),7);case 7:S=1;S=Number(((F=
y.actionMetadata)==null?void 0:F.priority)||0)+1;f=BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O,"playbackData",S,ZUs);g.qJ(G,6);break;case 5:p=g.AW(G);if(!(p instanceof Error&&p.message==="No data")){if(p instanceof Error&&p.message==="Empty response body")HV(p.message);else return E="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",u="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",p instanceof g.Y$&&p.type==="QUOTA_EXCEEDED"&&(E="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
u="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),G.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,E,u));G.Ez(6);break}return g.h(G,mp(l.G,O),9);case 9:I=G.K;q=g.P(y.actionMetadata,k6);if(v=(W=q)==null?void 0:W.playlistId)I.playlistId=v;I.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return g.h(G,A5(O,l.G,y,l.N,I),6);case 6:return G.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,f?[f]:void 0))}})},tyB=function(l,y){var r,c,O,H,V,T,f,N,S,F;
return g.Z(function(p){switch(p.G){case 1:return r=NC(y),g.Im(p,2),c=g.EX(y.entityKey).entityId,c==="!*$_ALL_ENTITIES_!*$"?g.h(p,Mfb(l.G,y,l.N,(S=y.actionMetadata)==null?void 0:(F=S.offlineLoggingData)==null?void 0:F.offlineDeleteReason),5):g.h(p,mp(l.G,c),6);case 6:O=p.K;H=g.P(y.actionMetadata,k6);if(T=(V=H)==null?void 0:V.playlistId)O.playlistId=T;O.offlineDeleteReason=(f=y.actionMetadata)==null?void 0:(N=f.offlineLoggingData)==null?void 0:N.offlineDeleteReason;return g.h(p,A5(c,l.G,y,l.N,O),7);
case 7:if(!l.GD.j("woffle_enable_main_downloads_library")){p.Ez(5);break}return g.h(p,A9J(l.G,y.entityKey),5);case 5:g.qJ(p,3);break;case 2:return g.AW(p),p.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return p.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r))}})},GHp=function(l,y,r,c,O){var H,V,T,f,N,S;
return g.Z(function(F){switch(F.G){case 1:if(H=c){F.Ez(2);break}return g.h(F,BnB([y]),3);case 3:V=F.K,H=V[0];case 2:return g.h(F,Drx(l,H,r,O),4);case 4:T=F.K;f=T.mainVideoEntity;N=T.channelEntity;g.Im(F,5);var p=a6(f.thumbnail),E=a6(N.avatar);return g.h(F,qC(p.concat(E)),7);case 7:g.qJ(F,0);break;case 5:S=g.AW(F),S instanceof Error&&S.message==="Failed to fetch"&&HV(S.message),g.Kl(F)}})},Drx=function(l,y,r,c){var O,H,V,T,f,N,S,F,p,E,u,I,q;
return g.Z(function(W){switch(W.G){case 1:r||(r=Date.now().toString());H=(O=y.channel)==null?void 0:O.offlineChannelData;V={id:g.uK(y.videoId,"ytMainChannelEntity"),channelId:H.channelId,title:H.title,avatar:H.thumbnail};T={key:g.uK(y.videoId,"mainVideoDownloadStateEntity"),playbackData:g.uK(y.videoId,"playbackData"),addedTimestampMillis:r,videoDownloadContextEntity:g.uK(y.videoId,"videoDownloadContextEntity")};f={key:g.uK(y.videoId,"videoPlaybackPositionEntity"),videoId:y.videoId,lastPlaybackPositionSeconds:"0"};
l.GD.j("html5_offline_playback_position_sync")&&(N={playbackPosition:f.key});S=g.uK(y.videoId,"mainVideoEntity");F={key:S,videoId:y.videoId,title:y.title,thumbnail:y.thumbnail,localizedStrings:{viewCount:y.shortViewCountText},userState:N,lengthSeconds:y.lengthSeconds?Number(y.lengthSeconds):void 0,publishedTimestampMillis:y.publishedTimestamp?(Number(y.publishedTimestamp)*1E3).toString():void 0,formattedDescription:y.description,owner:V.id,downloadState:T.key};if(!l.GD.j("woffle_enable_main_downloads_library")||
!c){W.Ez(2);break}return g.h(W,Ymg(l.G,[S]),3);case 3:if(u=W.K)p=u.mainDownloadsLibraryEntity,E=u.mainDownloadsListEntity;case 2:return q=Cvj,I={key:g.uK(y.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.Rn(T,q,I),g.h(W,kp(l.G,{mode:"readwrite",L$:!0},function(v){var G=bP(v,V,"ytMainChannelEntity"),D=bP(v,T,"mainVideoDownloadStateEntity"),w=bP(v,F,"mainVideoEntity");G=[G,D,w];l.GD.j("html5_offline_playback_position_sync")&&(D=bP(v,f,"videoPlaybackPositionEntity"),
G.push(D));p&&(D=bP(v,p,"mainDownloadsLibraryEntity"),G.push(D));E&&(D=bP(v,E,"mainDownloadsListEntity"),G.push(D));I&&(v=bP(v,I,"downloadStatusEntity"),G.push(v));return g.o$.all(G)}),4);
case 4:return W.return({mainVideoEntity:F,channelEntity:V})}})},drJ=function(l,y,r){this.G=l;
this.GD=y;this.N=r},X6J=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl,ls,x,L;
return g.Z(function(K){switch(K.G){case 1:return r=NC(y),c=[],g.h(K,Qq.getInstance(),2);case 2:O=K.K;if(!O){K.Ez(3);break}return g.h(K,O.get("sdois"),4);case 4:return H=K.K,g.h(K,(T=O)==null?void 0:T.get("lmqf"),5);case 5:V=K.K;case 3:g.Im(K,6);if(H===void 0)throw Error("prefStorage or opt-in state is undefined");f=[];if(H){K.Ez(8);break}return g.h(K,INJ(l.G),9);case 9:f=K.K,f.reverse();case 8:if(!f.length){K.Ez(10);break}N=g.a(f);S=N.next();case 11:if(S.done){K.Ez(10);break}F=S.value;if(!F){K.Ez(12);
break}p=g.EX(F).entityId;return g.h(K,mp(l.G,p),14);case 14:return E=K.K,E.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",g.h(K,A5(p,l.G,{entityKey:F,actionType:y.actionType},l.N,E),12);case 12:S=N.next();K.Ez(11);break;case 10:return g.h(K,XPg(H,(u=V)!=null?u:"SD"),16);case 16:return I=K.K,g.h(K,aNx(I),17);case 17:q=KOx(I);if(!l.GD.j("woffle_enable_main_downloads_library")){K.Ez(18);break}if(H){K.Ez(19);break}return g.h(K,A9J(l.G,g.tu),19);case 19:return g.h(K,qmz(l.G,[g.tu]),18);
case 18:if((W=q)==null?0:W.length)for(v=g.a(q),G=v.next();!G.done;G=v.next())if(w=D=G.value,U=w.actionType,R=w.entityKey,ON=w.actionMetadata,U&&R&&ON&&!g.P(ON,iUp)){U==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(ON.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Cl=g.P(D.actionMetadata,k6))Cl.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",D.actionMetadata=Object.assign({},D.actionMetadata,{mainVideoEntityActionMetadata:Cl});c.push(D)}g.qJ(K,7);break;
case 6:return ls=g.AW(K),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",ls instanceof g.Y$&&ls.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",L="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),K.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,x,L));case 7:return K.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,c))}})},QVQ=function(){R6.apply(this,arguments);
this.X="mainVideoEntity"},w6p=function(l,y,r){y=y===void 0?43200:y;
r=r===void 0?!0:r;var c=c===void 0?!1:c;var O,H,V;return g.Z(function(T){switch(T.G){case 1:if(!l.L.kR())return T.return([]);O=[];g.Im(T,2);return g.h(T,dPj(y,r,c),4);case 4:O=T.K;g.qJ(T,3);break;case 2:H=g.AW(T),H instanceof Error&&H.message==="No data"||H instanceof Error&&H.message==="Empty response body"&&HV(H.message);case 3:return V=Myj(l,O,r,"mainPlaylistEntity"),T.return(V)}})},Paj=function(l,y,r,c){c=c===void 0?!1:c;
var O,H,V,T,f,N,S,F,p,E,u,I,q,W,v;return g.Z(function(G){switch(G.G){case 1:return O=[],g.h(G,ioJ(),2);case 2:return(H=G.K)||c?g.h(G,QKj(y,r),3):G.return([]);case 3:V=G.K;if((T=V)==null||!T.length)return G.return([]);f={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};N=g.a(V);S=N.next();case 4:if(S.done){G.Ez(6);break}p=F=S.value;E=p.actionType;u=p.entityKey;I=p.actionMetadata;if(!(E&&u&&I)||g.P(I,iUp)){G.Ez(5);break}E==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(I.offlineLoggingData=
f);q=g.EX(u);W=q.entityId;return g.h(G,U$(l,[W],"mainVideoEntity",E,I),8);case 8:v=G.K,O=O.concat(v);case 5:S=N.next();G.Ez(4);break;case 6:return G.return(O)}})},xrp=function(l,y){this.G=l;
this.N=y},ngQ=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W;
return g.Z(function(v){switch(v.G){case 1:return r=NC(y),c=g.EX(y.entityKey),O=c.entityId,H=[],g.Im(v,2),g.h(v,eoJ(l,O),4);case 4:H=v.K;if((V=H)==null||!V.length){v.Ez(5);break}return g.h(v,oXQ(l.G,y.entityKey),5);case 5:g.qJ(v,3);break;case 2:return T=g.AW(v),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.Y$&&T.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,f,N));case 3:return S=[],g.h(v,gXH(l.G,"musicTrack",H),7);case 7:H=v.K;if(H.length)for(F=g.a(H),p=F.next();!p.done;p=F.next())if(E=p.value,u=E.offlineVideoData,I=void 0,(I=u)==null?0:I.videoId)q=void 0,W=Number(((q=y.actionMetadata)==null?void 0:q.priority)||0)+1,S.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",u.videoId,"musicTrack",W,j3,h5(y,u,O)));return v.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,S))}})},
bUH=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl,ls,x,L,K,e,Xv,Ig,FQ,vz,jC,Hx,uj,A,m,J,B,d,yN,Hz,VN,t,NJ,MJ,TZ,GZ,pp,ij,Fw,eC,Xw,gc,Z0,xT,fH,x_;
return g.Z(function(QK){switch(QK.G){case 1:return r=NC(y),c=y.entityKey,O=g.EX(c).entityId,H=[],V=!1,O==="!*$_ALL_ENTITIES_!*$"?(V=!0,g.h(QK,lL(l.G,"musicAlbumRelease"),5)):g.h(QK,LB(l.G,c,"musicAlbumRelease"),4);case 4:(T=QK.K)&&H.push(T);QK.Ez(3);break;case 5:H=QK.K;case 3:if((f=H)==null||!f.length)return QK.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));if(V){N=[];S=g.a(H);for(F=S.next();!F.done;F=S.next())p=F.value,E=g.EX(p.id).entityId,N.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
E,"musicAlbumRelease",0,j3));return QK.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,N))}u=[];I=H[0];q=void 0;if(!I.downloadMetadata){QK.Ez(6);break}return g.h(QK,LB(l.G,I.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:W=QK.K,q=Number((G=(v=W)==null?void 0:v.addedTimestampMillis)!=null?G:"0")/1E3;case 6:return g.Im(QK,8),g.h(QK,eoJ(l,O,(D=q)==null?void 0:D.toString()),10);case 10:u=QK.K;g.qJ(QK,9);break;case 8:w=g.AW(QK);if(!(w instanceof Error&&w.message===
"No data")){if(w instanceof Error&&w.message==="Empty response body")HV(w.message);else return U="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",R="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",w instanceof g.Y$&&w.type==="QUOTA_EXCEEDED"&&(U="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",R="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),QK.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,U,R));QK.Ez(9);break}return g.h(QK,J5(O,"musicAlbumRelease",l.G,
y,l.N),9);case 9:ON=[];Cl=new Map;if((ls=u)==null?0:ls.length)for(x=g.a(u),L=x.next();!L.done;L=x.next())K=L.value,e=K.offlineVideoData,Xv=void 0,((Xv=e)==null?0:Xv.videoId)&&Cl.set(e.videoId,e);Ig=new Map;FQ=[];if((vz=I)==null?0:(jC=vz.tracks)==null?0:jC.length)for(Hx=g.a(I.tracks),uj=Hx.next();!uj.done;uj=Hx.next())if(A=uj.value,m=g.EX(A).entityId)Cl.has(m)?(Ig.set(m,Cl.get(m)),Cl.delete(m)):FQ.push(m);B=Number(((J=y.actionMetadata)==null?void 0:J.priority)||0)+1;d=g.a(Cl.entries());for(yN=d.next();!yN.done;yN=
d.next())Hz=yN.value,VN=g.a(Hz),t=VN.next().value,NJ=VN.next().value,MJ=t,TZ=NJ,ON.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",MJ,"musicTrack",B,j3,h5(y,TZ)));GZ=g.a(Ig.entries());for(pp=GZ.next();!pp.done;pp=GZ.next())ij=pp.value,Fw=g.a(ij),eC=Fw.next().value,Xw=Fw.next().value,gc=eC,Z0=Xw,ON.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",gc,"musicTrack",B,j3,h5(y,Z0)));xT=g.a(FQ);for(fH=xT.next();!fH.done;fH=xT.next())x_=fH.value,ON.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",x_,
"musicTrack",0,j3));return QK.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,ON))}})},RoJ=function(l,y){var r,c;
return g.Z(function(O){switch(O.G){case 1:return r=NC(y),g.Im(O,2),c=g.EX(y.entityKey).entityId,c==="!*$_ALL_ENTITIES_!*$"?g.h(O,o6(l.G,y,l.N),5):g.h(O,J5(c,"musicAlbumRelease",l.G,y,l.N),6);case 6:return g.h(O,hTJ(l.G,y.entityKey),5);case 5:g.qJ(O,3);break;case 2:return g.AW(O),O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},eoJ=function(l,y,r){var c,O,H;
return g.Z(function(V){switch(V.G){case 1:return g.h(V,tfb([y]),2);case 2:return c=V.K,g.h(V,UrI(l,c[0],r),3);case 3:return O=V.K,H=a6(O.thumbnailDetails),g.h(V,qC(H),4);case 4:return V.return(c[0].videos)}})},UrI=function(l,y,r){var c,O,H,V,T,f,N,S,F,p,E,u,I,q;
return g.Z(function(W){if(W.G==1){c=y.additionalMetadadatas;O=void 0;if(c&&c.length>0)for(H=g.a(c),V=H.next();!V.done;V=H.next())if(T=V.value,T.offlineMusicPlaylistData){O=T.offlineMusicPlaylistData;break}f=y.playlistId;N=GGj(y);S=N.M7;F=N.EY;p=r?(Number(r)*1E3).toString():Date.now().toString();E=y.lastModifiedTimestamp?(Number(y.lastModifiedTimestamp)*1E3).toString():"0";u={id:g.uK(f,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:F,lastModifiedTimestampMillis:E,addedTimestampMillis:p,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};I={id:g.uK(f,"musicAlbumRelease"),title:y.title,audioPlaylistId:f,trackCount:y.totalVideoCount,tracks:S,downloadMetadata:u.id};O&&(I.thumbnailDetails=(q=O.albumHqThumbnail)!=null?q:O.albumArtistThumbnail,I.artistDisplayName=O.albumArtistDisplayName,I.releaseDate=O.albumReleaseDate,I.contentRating={explicitType:O.albumReleaseExplicitType},I.releaseType=O.albumReleaseType);return g.h(W,kp(l.G,{mode:"readwrite",L$:!0},function(v){var G=bP(v,I,"musicAlbumRelease");
v=bP(v,u,"musicAlbumReleaseDownloadMetadataEntity");return g.o$.all([G,v])}),2)}return W.return(I)})},zoH=function(l,y){this.G=l;
this.N=y},jVJ=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W;
return g.Z(function(v){switch(v.G){case 1:return r=NC(y),c=g.EX(y.entityKey),O=c.entityId,H=[],g.Im(v,2),g.h(v,kHs(l,O),4);case 4:H=v.K;if((V=H)==null||!V.length){v.Ez(5);break}return g.h(v,oXQ(l.G,y.entityKey),5);case 5:g.qJ(v,3);break;case 2:return T=g.AW(v),f="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",T instanceof g.Y$&&T.type==="QUOTA_EXCEEDED"&&(f="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",N="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
v.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,f,N));case 3:return S=[],g.h(v,gXH(l.G,"musicTrack",H),7);case 7:H=v.K;if(H.length)for(F=g.a(H),p=F.next();!p.done;p=F.next())if(E=p.value,u=E.offlineVideoData,I=void 0,(I=u)==null?0:I.videoId)q=void 0,W=Number(((q=y.actionMetadata)==null?void 0:q.priority)||0)+1,S.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",u.videoId,"musicTrack",W,Lm,h5(y,u,O)));return v.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,S))}})},
L1j=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl,ls,x,L,K,e,Xv,Ig,FQ,vz,jC,Hx,uj,A,m,J,B,d,yN,Hz,VN,t,NJ,MJ,TZ,GZ,pp,ij,Fw,eC,Xw,gc,Z0,xT,fH,x_,QK,e4,se,No,Jy,FJ,oL,BX,tn,Av,j9,ng;
return g.Z(function(cI){switch(cI.G){case 1:return r=NC(y),c=y.entityKey,O=g.EX(c).entityId,H=[],V=!1,O==="!*$_ALL_ENTITIES_!*$"?(V=!0,g.h(cI,lL(l.G,"musicPlaylist"),5)):g.h(cI,LB(l.G,c,"musicPlaylist"),4);case 4:(T=cI.K)&&H.push(T);cI.Ez(3);break;case 5:H=cI.K;case 3:if((f=H)==null||!f.length)return cI.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));N=g.P(y.actionMetadata,ZoQ);F=(S=N)==null?void 0:S.autoSync;p=[];u=E=!0;I=!1;q=void 0;if(!V&&F===!1){cI.Ez(6);break}g.Im(cI,7);return g.h(cI,
wPJ(0,!!F,!0,H),9);case 9:p=cI.K;g.qJ(cI,8);break;case 7:W=g.AW(cI);if(!(W instanceof Error&&W.message==="No data")){W instanceof Error&&W.message==="Empty response body"&&HV(W.message);cI.Ez(8);break}return O==="!*$_ALL_ENTITIES_!*$"?g.h(cI,o6(l.G,y,l.N),8):g.h(cI,J5(O,"musicPlaylist",l.G,y,l.N),8);case 8:if(!p.length||!V&&p[0].playlistId!==O)return cI.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));case 6:if(V){v=[];G=g.a(p);for(D=G.next();!D.done;D=G.next())w=D.value,w.upToDate||
F&&!w.shouldAutoSyncMetadata||!w.playlistId||(U={autoSync:F},v.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",w.playlistId,"musicPlaylist",0,Lm,{musicPlaylistEntityActionMetadata:U})));return cI.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,v))}p.length&&(R=p[0],I=!!R.upToDate,F&&(E=(ON=R.shouldAutoSyncMetadata)!=null?ON:!0,u=(Cl=R.shouldAutoSyncVideos)!=null?Cl:!0,R.checkInSeconds&&(q=R.checkInSeconds)));if(I||!E)return cI.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r));ls=[];x=H[0];L=void 0;if(!x.downloadMetadata){cI.Ez(15);break}return g.h(cI,LB(l.G,x.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:K=cI.K,L=Number((Xv=(e=K)==null?void 0:e.addedTimestampMillis)!=null?Xv:"0")/1E3;case 15:return g.Im(cI,17),g.h(cI,kHs(l,O,(Ig=L)==null?void 0:Ig.toString(),q),19);case 19:ls=cI.K;g.qJ(cI,18);break;case 17:FQ=g.AW(cI);if(!(FQ instanceof Error&&FQ.message==="No data")){if(FQ instanceof Error&&FQ.message==="Empty response body")HV(FQ.message);else return vz=
"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",jC="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",FQ instanceof g.Y$&&FQ.type==="QUOTA_EXCEEDED"&&(vz="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",jC="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),cI.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,vz,jC));cI.Ez(18);break}return g.h(cI,J5(O,"musicPlaylist",l.G,y,l.N),18);case 18:if(!u)return cI.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r));Hx=[];uj=new Map;if((A=ls)==null?0:A.length)for(m=g.a(ls),J=m.next();!J.done;J=m.next())B=J.value,d=B.offlineVideoData,yN=void 0,((yN=d)==null?0:yN.videoId)&&uj.set(d.videoId,d);Hz=new Map;VN=[];if((t=x)==null?0:(NJ=t.tracks)==null?0:NJ.length)for(MJ=g.a(x.tracks),TZ=MJ.next();!TZ.done;TZ=MJ.next())if(GZ=TZ.value,pp=g.EX(GZ).entityId)uj.has(pp)?(Hz.set(pp,uj.get(pp)),uj.delete(pp)):VN.push(pp);Fw=Number(((ij=y.actionMetadata)==null?void 0:ij.priority)||0)+1;eC=g.a(uj.entries());for(Xw=eC.next();!Xw.done;Xw=
eC.next())gc=Xw.value,Z0=g.a(gc),xT=Z0.next().value,fH=Z0.next().value,x_=xT,QK=fH,Hx.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",x_,"musicTrack",Fw,Lm,h5(y,QK)));e4=g.a(Hz.entries());for(se=e4.next();!se.done;se=e4.next())No=se.value,Jy=g.a(No),FJ=Jy.next().value,oL=Jy.next().value,BX=FJ,tn=oL,Hx.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",BX,"musicTrack",Fw,Lm,h5(y,tn)));Av=g.a(VN);for(j9=Av.next();!j9.done;j9=Av.next())ng=j9.value,Hx.push(BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
ng,"musicTrack",0,Lm));return cI.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,Hx))}})},lvI=function(l,y){var r,c;
return g.Z(function(O){switch(O.G){case 1:return r=NC(y),g.Im(O,2),c=g.EX(y.entityKey).entityId,c==="!*$_ALL_ENTITIES_!*$"?g.h(O,o6(l.G,y,l.N),5):g.h(O,J5(c,"musicPlaylist",l.G,y,l.N),6);case 6:return g.h(O,hTJ(l.G,y.entityKey),5);case 5:g.qJ(O,3);break;case 2:return g.AW(O),O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},kHs=function(l,y,r,c){var O,H,V;
return g.Z(function(T){switch(T.G){case 1:return g.h(T,tfb([y]),2);case 2:return O=T.K,g.h(T,y8I(l,O[0],r,c),3);case 3:return H=T.K,V=a6(H.thumbnailDetails),g.h(T,qC(V),4);case 4:return T.return(O[0].videos)}})},y8I=function(l,y,r,c){var O,H,V,T,f,N,S,F,p;
return g.Z(function(E){return E.G==1?(O=y.playlistId,H=GGj(y),V=H.M7,T=H.EY,f=r?(Number(r)*1E3).toString():Date.now().toString(),N=y.lastModifiedTimestamp?(Number(y.lastModifiedTimestamp)*1E3).toString():"0",S={id:g.uK(O,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:T,lastModifiedTimestampMillis:N,addedTimestampMillis:f,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},F={id:g.uK(O,"musicPlaylist"),title:y.title,playlistId:O,thumbnailDetails:y.thumbnail,visibility:r8p(y),trackCount:y.totalVideoCount,
tracks:V,downloadMetadata:S.id},c&&(((p=F)==null?0:p.entityMetadata)?F.entityMetadata.nextAutoRefreshIntervalSeconds=String(c):F&&(F.entityMetadata={nextAutoRefreshIntervalSeconds:String(c)})),g.h(E,kp(l.G,{mode:"readwrite",L$:!0},function(u){var I=bP(u,F,"musicPlaylist");u=bP(u,S,"musicPlaylistDownloadMetadataEntity");return g.o$.all([I,u])}),2)):E.return(F)})},r8p=function(l){switch(l.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},c8J=function(l,y){this.G=l;
this.N=y},Cog=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u;
return g.Z(function(I){switch(I.G){case 1:return r=NC(y),c=g.EX(y.entityKey),O=c.entityId,H=g.P(y.actionMetadata,ONH),g.Im(I,2),g.h(I,HNx(l,O,void 0,(V=H)==null?void 0:V.track,(T=H)==null?void 0:T.albumRelease),4);case 4:if((f=H)==null?0:f.playlistId){I.Ez(5);break}return g.h(I,oXQ(l.G,y.entityKey),5);case 5:g.qJ(I,3);break;case 2:return N=g.AW(I),S="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.Y$&&N.type==="QUOTA_EXCEEDED"&&
(S="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",F="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),I.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,S,F));case 3:E=Number(((p=y.actionMetadata)==null?void 0:p.priority)||0)+1;var q=(q=g.P(y.actionMetadata,ONH))?{playbackDataActionMetadata:{maximumDownloadQuality:q.maximumDownloadQuality}}:void 0;u=BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",O,"playbackData",E,VWj,q);return I.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r,[u]))}})},g1J=function(l,y){var r,c,O,H,V,T,f,N,S,F,p,E,u,I,q;
return g.Z(function(W){switch(W.G){case 1:return r=NC(y),c=g.EX(y.entityKey),O=c.entityId,g.h(W,LB(l.G,y.entityKey,"musicTrack"),2);case 2:H=W.K;if(!H){V=void 0;W.Ez(3);break}return g.h(W,LB(l.G,H.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:V=W.K;case 3:T=V;if(!H||!T)return W.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r));N=g.P(y.actionMetadata,ONH);g.Im(W,5);return g.h(W,HNx(l,O,T.addedTimestampMillis,(S=N)==null?void 0:S.track,(F=N)==null?void 0:F.albumRelease),
7);case 7:E=Number(((p=y.actionMetadata)==null?void 0:p.priority)||0)+1;f=BV("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",O,"playbackData",E,VWj);g.qJ(W,6);break;case 5:u=g.AW(W);if(!(u instanceof Error&&u.message==="No data")){if(u instanceof Error&&u.message==="Empty response body")HV(u.message);else return I="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",q="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.Y$&&u.type==="QUOTA_EXCEEDED"&&(I="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
q="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),W.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,I,q));W.Ez(6);break}return g.h(W,vV(O,l.G,y,l.N),6);case 6:return W.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",r,f?[f]:void 0))}})},Tfg=function(l,y){var r,c;
return g.Z(function(O){switch(O.G){case 1:return r=NC(y),g.Im(O,2),c=g.EX(y.entityKey).entityId,c==="!*$_ALL_ENTITIES_!*$"?g.h(O,o6(l.G,y,l.N),5):g.h(O,vV(c,l.G,y,l.N),6);case 6:return g.h(O,hTJ(l.G,y.entityKey),5);case 5:g.qJ(O,3);break;case 2:return g.AW(O),O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",r,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return O.return(new t5("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
r))}})},HNx=function(l,y,r,c,O){var H,V,T,f,N,S;
return g.Z(function(F){switch(F.G){case 1:if(H=c){F.Ez(2);break}return g.h(F,BnB([y]),3);case 3:V=F.K,T=V[0],H=J9j(T);case 2:return g.h(F,fvg(l,H,y,O,r),4);case 4:f=F.K;N=f.musicTrackEntity;S=f.Fe;var p=a6(N.thumbnailDetails),E=[];S&&(E=a6(S.thumbnailDetails));return g.h(F,qC(p.concat(E)),0)}})},fvg=function(l,y,r,c,O){var H;
return g.Z(function(V){return V.G==1?(O||(O=Date.now().toString()),H={id:g.uK(r,"musicTrackDownloadMetadataEntity"),playbackData:g.uK(r,"playbackData"),addedTimestampMillis:O,videoDownloadContextEntity:g.uK(r,"videoDownloadContextEntity")},c&&(y.albumRelease=c.id),g.h(V,kp(l.G,{mode:"readwrite",L$:!0},function(T){var f=[],N=bP(T,H,"musicTrackDownloadMetadataEntity");f.push(N);N=bP(T,y,"musicTrack");f.push(N);c&&(T=bP(T,c,"musicAlbumRelease"),f.push(T));return g.o$.all(f)}),2)):V.G!=3?g.h(V,E$(r,"musicTrackDownloadMetadataEntity",
l.G,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):V.return({musicTrackEntity:y,
Fe:c})})},lR=function(){R6.apply(this,arguments);
this.X="musicTrack"},Nfg=function(l,y,r){y=y===void 0?43200:y;
r=r===void 0?!0:r;var c=c===void 0?!1:c;var O,H;return g.Z(function(V){switch(V.G){case 1:if(!l.L.kR())return V.return([]);O=[];g.Im(V,2);return g.h(V,wPJ(y,r,c),4);case 4:O=V.K;g.qJ(V,3);break;case 2:g.AW(V);case 3:return H=Myj(l,O,r,"musicPlaylist"),V.return(H)}})},SlJ=function(){g.IG.apply(this,arguments);
var l=this;this.events=new g.n4(this);this.GD=this.player.D();this.GT={jj8:function(){return l.G},
JJ:function(){return l.JJ()},
yH:function(y){return l.yH(y)}}},FRb=function(l){var y;
l=g.P((y=l.getWatchNextResponse())==null?void 0:y.currentVideoEndpoint,g.VP);if(l==null?0:l.playlistId)var r=l.playlistId;return r},plb=function(l,y){var r,c,O,H;
return g.Z(function(V){if(V.G==1){r=y.clientPlaybackNonce;c={cpn:r,offlineSourceVisualElement:g.hT(y.Mf||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};y.K&&(c.videoFmt=Number(y.K.itag));y.B&&(c.audioFmt=Number(y.B.itag));if((O=FRb(y))&&y.videoId){var T=y.videoId;T=O!=="PPSV"?Promise.resolve(!1):l.G.KS(T);V=g.h(V,T,3)}else V=V.Ez(2);return V}V.G!=2&&(H=V.K)&&(c.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");l.K=r;g.EE("offlinePlaybackStarted",c);g.Kl(V)})};
g.$h.prototype.Py=g.cz(51,function(l){return this.app.Py(l)});
g.af.prototype.Py=g.cz(50,function(l){return g.XVd(this,9,l)});
g.M(iP,dS);g.gd.Object.defineProperties(iP.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.G.entityMetadata},
set:function(l){this.G.entityMetadata=l}}});
g.M(gUs,iP);gUs.prototype.K=function(){return[]};
g.M(T9I,iP);T9I.prototype.K=function(){return[]};
g.M(f1J,iP);f1J.prototype.K=function(){return[]};
g.M(N9g,iP);N9g.prototype.K=function(){return[]};
g.M(SGJ,iP);SGJ.prototype.K=function(){var l=[];this.G.alternateChannel&&l.push(this.G.alternateChannel);this.G.alternateChannelList&&l.push.apply(l,g.Y(this.G.alternateChannelList));this.G.oneofChannelEntity&&l.push(this.G.oneofChannelEntity);return[].concat(g.Y(new Set(l)))};
g.M(F6Q,iP);F6Q.prototype.K=function(){var l=[];this.G.entryCollection&&l.push(this.G.entryCollection);return[].concat(g.Y(new Set(l)))};
g.M(pXs,dS);pXs.prototype.K=function(){var l=[];this.G.video&&l.push(this.G.video);return[].concat(g.Y(new Set(l)))};
g.M(EUJ,iP);EUJ.prototype.K=function(){var l=[];this.G.parentPlaylist&&l.push(this.G.parentPlaylist);if(this.G.entries)for(var y=g.a(this.G.entries),r=y.next();!r.done;r=y.next())l.push.apply(l,g.Y((new pXs(r.value)).K()));return[].concat(g.Y(new Set(l)))};
g.M(uKg,iP);uKg.prototype.K=function(){var l=[];this.G.descriptionEntity&&l.push(this.G.descriptionEntity);this.G.creators&&l.push.apply(l,g.Y(this.G.creators));this.G.theBiggestFan&&l.push(this.G.theBiggestFan);return[].concat(g.Y(new Set(l)))};
g.M(M0J,iP);M0J.prototype.K=function(){return[]};
g.M(a1H,iP);a1H.prototype.K=function(){return[]};
g.M(spH,iP);spH.prototype.K=function(){return[]};
g.M(K6Q,iP);K6Q.prototype.K=function(){return[]};
g.M(I1g,iP);I1g.prototype.K=function(){return[]};
g.M(YGB,iP);YGB.prototype.K=function(){return[]};
g.M(qGH,iP);qGH.prototype.K=function(){return[]};
g.M(Anz,iP);Anz.prototype.K=function(){return[]};
g.M(W6p,iP);W6p.prototype.K=function(){return[]};
g.M(mSb,iP);mSb.prototype.K=function(){var l=[];this.G.downloadsList&&l.push(this.G.downloadsList);this.G.smartDownloadsList&&l.push(this.G.smartDownloadsList);this.G.recommendedDownloadsList&&l.push(this.G.recommendedDownloadsList);this.G.refresh&&l.push(this.G.refresh);return[].concat(g.Y(new Set(l)))};
g.M(vUJ,dS);vUJ.prototype.K=function(){var l=[];this.G.video&&l.push(this.G.video);this.G.playlist&&l.push(this.G.playlist);this.G.videoItem&&l.push(this.G.videoItem);this.G.playlistItem&&l.push(this.G.playlistItem);return[].concat(g.Y(new Set(l)))};
g.M(JnJ,iP);JnJ.prototype.K=function(){var l=[];this.G.refresh&&l.push(this.G.refresh);if(this.G.downloads)for(var y=g.a(this.G.downloads),r=y.next();!r.done;r=y.next())l.push.apply(l,g.Y((new vUJ(r.value)).K()));return[].concat(g.Y(new Set(l)))};
g.M(oUz,iP);oUz.prototype.K=function(){var l=[];this.G.localImageEntities&&l.push.apply(l,g.Y(this.G.localImageEntities));return[].concat(g.Y(new Set(l)))};
g.M(h7B,iP);h7B.prototype.K=function(){var l=[];this.G.playbackData&&l.push(this.G.playbackData);this.G.localImageEntities&&l.push.apply(l,g.Y(this.G.localImageEntities));this.G.videoDownloadContextEntity&&l.push(this.G.videoDownloadContextEntity);return[].concat(g.Y(new Set(l)))};
g.M(G$z,iP);G$z.prototype.K=function(){return[]};
g.M(Ztx,iP);Ztx.prototype.K=function(){var l=[];this.G.fakeChildren&&l.push.apply(l,g.Y(this.G.fakeChildren));return[].concat(g.Y(new Set(l)))};
g.M($Sg,iP);$Sg.prototype.K=function(){var l=[];this.G.video&&l.push(this.G.video);this.G.playbackData&&l.push(this.G.playbackData);this.G.offlineVideoPolicy&&l.push(this.G.offlineVideoPolicy);return[].concat(g.Y(new Set(l)))};
g.M(B9j,iP);B9j.prototype.K=function(){return[]};
g.M(t0J,iP);t0J.prototype.K=function(){var l=[];this.G.channelOwner&&l.push(this.G.channelOwner);this.G.videos&&l.push.apply(l,g.Y(this.G.videos));this.G.collaboratorChannels&&l.push.apply(l,g.Y(this.G.collaboratorChannels));this.G.downloadState&&l.push(this.G.downloadState);this.G.refresh&&l.push(this.G.refresh);return[].concat(g.Y(new Set(l)))};
g.M(DSb,iP);DSb.prototype.K=function(){var l=[];this.G.video&&l.push(this.G.video);this.G.channelContributor&&l.push(this.G.channelContributor);return[].concat(g.Y(new Set(l)))};
g.M(dSp,dS);dSp.prototype.K=function(){var l=[];this.G.localImageEntities&&l.push.apply(l,g.Y(this.G.localImageEntities));this.G.videoDownloadContextEntity&&l.push(this.G.videoDownloadContextEntity);return[].concat(g.Y(new Set(l)))};
g.M(itj,dS);itj.prototype.K=function(){var l=[];this.G.recommendedVideoMetadata&&l.push.apply(l,g.Y((new dSp(this.G.recommendedVideoMetadata)).K()));return[].concat(g.Y(new Set(l)))};
g.M(XXQ,dS);XXQ.prototype.K=function(){var l=[];this.G.playbackPosition&&l.push(this.G.playbackPosition);return[].concat(g.Y(new Set(l)))};
g.M(QpH,iP);QpH.prototype.K=function(){var l=[];this.G.owner&&l.push(this.G.owner);this.G.downloadState&&l.push(this.G.downloadState);this.G.userState&&l.push.apply(l,g.Y((new XXQ(this.G.userState)).K()));this.G.additionalMetadata&&l.push.apply(l,g.Y((new itj(this.G.additionalMetadata)).K()));return[].concat(g.Y(new Set(l)))};
g.M(wXJ,iP);wXJ.prototype.K=function(){var l=[];this.G.userChannelDetails&&l.push(this.G.userChannelDetails);return[].concat(g.Y(new Set(l)))};
g.M(PAJ,iP);PAJ.prototype.K=function(){var l=[];this.G.channelOwner&&l.push(this.G.channelOwner);this.G.playbackPosition&&l.push(this.G.playbackPosition);this.G.localImageEntities&&l.push.apply(l,g.Y(this.G.localImageEntities));this.G.downloadStatus&&l.push(this.G.downloadStatus);return[].concat(g.Y(new Set(l)))};
g.M(xSH,iP);xSH.prototype.K=function(){return[]};
g.M(e7j,iP);e7j.prototype.K=function(){return[]};
g.M(nUI,iP);nUI.prototype.K=function(){return[]};
g.M(btJ,iP);btJ.prototype.K=function(){return[]};
g.M(R7H,iP);R7H.prototype.K=function(){return[]};
g.M(USQ,iP);USQ.prototype.K=function(){return[]};
g.M(z7H,iP);z7H.prototype.K=function(){return[]};
g.M(k$j,iP);k$j.prototype.K=function(){return[]};
g.M(jpg,iP);jpg.prototype.K=function(){return[]};
g.M(L6J,iP);L6J.prototype.K=function(){return[]};
g.M(lrB,iP);lrB.prototype.K=function(){return[]};
g.M(yNH,iP);yNH.prototype.K=function(){var l=[];this.G.trackDownloadMetadatas&&l.push.apply(l,g.Y(this.G.trackDownloadMetadatas));return[].concat(g.Y(new Set(l)))};
g.M(rNj,iP);
rNj.prototype.K=function(){var l=[];this.G.downloadedTracks&&l.push.apply(l,g.Y(this.G.downloadedTracks));this.G.smartDownloadedTracks&&l.push.apply(l,g.Y(this.G.smartDownloadedTracks));this.G.downloadedEpisodes&&l.push.apply(l,g.Y(this.G.downloadedEpisodes));this.G.downloadedAlbumReleases&&l.push.apply(l,g.Y(this.G.downloadedAlbumReleases));this.G.smartDownloadedAlbumReleases&&l.push.apply(l,g.Y(this.G.smartDownloadedAlbumReleases));this.G.downloadedPlaylists&&l.push.apply(l,g.Y(this.G.downloadedPlaylists));this.G.smartDownloadedPlaylists&&
l.push.apply(l,g.Y(this.G.smartDownloadedPlaylists));this.G.metadataOnlyTracks&&l.push.apply(l,g.Y(this.G.metadataOnlyTracks));return[].concat(g.Y(new Set(l)))};
g.M(cNj,iP);cNj.prototype.K=function(){var l=[];this.G.trackDownloadMetadatas&&l.push.apply(l,g.Y(this.G.trackDownloadMetadatas));return[].concat(g.Y(new Set(l)))};
g.M(ObJ,iP);ObJ.prototype.K=function(){var l=[];this.G.playbackData&&l.push(this.G.playbackData);this.G.localImageEntities&&l.push.apply(l,g.Y(this.G.localImageEntities));this.G.videoDownloadContextEntity&&l.push(this.G.videoDownloadContextEntity);return[].concat(g.Y(new Set(l)))};
g.M(HbJ,iP);HbJ.prototype.K=function(){var l=[];this.G.musicLibraryStatusEntity&&l.push(this.G.musicLibraryStatusEntity);this.G.primaryArtists&&l.push.apply(l,g.Y(this.G.primaryArtists));this.G.details&&l.push(this.G.details);this.G.userDetails&&l.push(this.G.userDetails);this.G.tracks&&l.push.apply(l,g.Y(this.G.tracks));this.G.share&&l.push(this.G.share);this.G.downloadMetadata&&l.push(this.G.downloadMetadata);this.G.refresh&&l.push(this.G.refresh);return[].concat(g.Y(new Set(l)))};
g.M(VNx,iP);VNx.prototype.K=function(){var l=[];this.G.albumRelease&&l.push(this.G.albumRelease);this.G.tracks&&l.push.apply(l,g.Y(this.G.tracks));return[].concat(g.Y(new Set(l)))};
g.M(C9j,iP);C9j.prototype.K=function(){var l=[];this.G.albumRelease&&l.push(this.G.albumRelease);return[].concat(g.Y(new Set(l)))};
g.M(gZs,iP);gZs.prototype.K=function(){var l=[];this.G.details&&l.push(this.G.details);this.G.userDetails&&l.push(this.G.userDetails);return[].concat(g.Y(new Set(l)))};
g.M(TiB,iP);TiB.prototype.K=function(){var l=[];this.G.parentArtist&&l.push(this.G.parentArtist);return[].concat(g.Y(new Set(l)))};
g.M(frg,iP);frg.prototype.K=function(){var l=[];this.G.parentArtist&&l.push(this.G.parentArtist);return[].concat(g.Y(new Set(l)))};
g.M(NiJ,iP);NiJ.prototype.K=function(){return[]};
g.M(SKg,iP);SKg.prototype.K=function(){return[]};
g.M(FYg,dS);FYg.prototype.K=function(){var l=[];this.G.creatorEntity&&l.push(this.G.creatorEntity);return[].concat(g.Y(new Set(l)))};
g.M(puz,iP);
puz.prototype.K=function(){var l=[];this.G.tracks&&l.push.apply(l,g.Y(this.G.tracks));this.G.refresh&&l.push(this.G.refresh);this.G.musicLibraryStatusEntity&&l.push(this.G.musicLibraryStatusEntity);this.G.details&&l.push(this.G.details);this.G.downloadMetadata&&l.push(this.G.downloadMetadata);this.G.sideloadMetadata&&l.push(this.G.sideloadMetadata);this.G.userDetails&&l.push(this.G.userDetails);this.G.entryCollection&&l.push(this.G.entryCollection);this.G.share&&l.push(this.G.share);this.G.podcastShowAdditionalMetadata&&l.push.apply(l,
g.Y((new FYg(this.G.podcastShowAdditionalMetadata)).K()));return[].concat(g.Y(new Set(l)))};
g.M(EZz,iP);EZz.prototype.K=function(){return[]};
g.M(ugJ,iP);
ugJ.prototype.K=function(){var l=[];this.G.musicLibraryStatusEntity&&l.push(this.G.musicLibraryStatusEntity);this.G.artists&&l.push.apply(l,g.Y(this.G.artists));this.G.audioModeVersion&&l.push(this.G.audioModeVersion);this.G.videoModeVersion&&l.push(this.G.videoModeVersion);this.G.userDetails&&l.push(this.G.userDetails);this.G.details&&l.push(this.G.details);this.G.albumRelease&&l.push(this.G.albumRelease);this.G.share&&l.push(this.G.share);this.G.libraryEdit&&l.push(this.G.libraryEdit);this.G.downloadMetadata&&
l.push(this.G.downloadMetadata);this.G.playbackPosition&&l.push(this.G.playbackPosition);this.G.lyrics&&l.push(this.G.lyrics);return[].concat(g.Y(new Set(l)))};
g.M(MNb,iP);MNb.prototype.K=function(){var l=[];this.G.parentTrack&&l.push(this.G.parentTrack);return[].concat(g.Y(new Set(l)))};
g.M(arj,iP);arj.prototype.K=function(){var l=[];this.G.parentTrack&&l.push(this.G.parentTrack);return[].concat(g.Y(new Set(l)))};
g.M(sJQ,iP);sJQ.prototype.K=function(){return[]};
g.M(KYj,iP);KYj.prototype.K=function(){return[]};
g.M(Irj,iP);Irj.prototype.K=function(){return[]};
g.M(YKz,iP);YKz.prototype.K=function(){return[]};
g.M(qKI,iP);qKI.prototype.K=function(){var l=[];this.G.transfer&&l.push(this.G.transfer);this.G.adsPlaybackData&&l.push.apply(l,g.Y(this.G.adsPlaybackData));this.G.drmLicense&&l.push(this.G.drmLicense);this.G.offlineVideoPolicy&&l.push(this.G.offlineVideoPolicy);this.G.videoDownloadContextEntity&&l.push(this.G.videoDownloadContextEntity);return[].concat(g.Y(new Set(l)))};
g.M(ANg,iP);ANg.prototype.K=function(){return[]};
g.M(WYQ,iP);WYQ.prototype.K=function(){var l=[];this.G.offlineVideoStreams&&l.push.apply(l,g.Y(this.G.offlineVideoStreams));this.G.captionTrack&&l.push.apply(l,g.Y(this.G.captionTrack));return[].concat(g.Y(new Set(l)))};
g.M(m4x,iP);m4x.prototype.K=function(){return[]};
g.M(vZJ,iP);vZJ.prototype.K=function(){return[]};
g.M(JNj,iP);JNj.prototype.K=function(){return[]};
g.M(oZQ,iP);oZQ.prototype.K=function(){return[]};
g.M(hLx,iP);hLx.prototype.K=function(){return[]};
g.M(GOj,iP);GOj.prototype.K=function(){return[]};
g.M(ZbQ,iP);ZbQ.prototype.K=function(){return[]};
g.M($4b,iP);$4b.prototype.K=function(){return[]};
g.M(Bis,iP);Bis.prototype.K=function(){return[]};
g.M(tNz,iP);tNz.prototype.K=function(){return[]};
g.M(D4g,iP);D4g.prototype.K=function(){return[]};
g.M(d4Q,iP);d4Q.prototype.K=function(){return[]};
g.M(ibH,iP);ibH.prototype.K=function(){return[]};
g.M(Xuz,iP);Xuz.prototype.K=function(){return[]};
g.M(QJI,iP);QJI.prototype.K=function(){return[]};
g.M(wuj,iP);wuj.prototype.K=function(){return[]};
g.M(P9H,iP);P9H.prototype.K=function(){return[]};
g.M(x4z,iP);x4z.prototype.K=function(){return[]};
g.M(eLQ,iP);eLQ.prototype.K=function(){return[]};
g.M(nZQ,iP);nZQ.prototype.K=function(){return[]};
var PvJ=["browse","music/browse","unplugged/browse"],RTQ=["offline/playlist_sync_check"],$Ps=["offline"],xPB=["offline/offline_video_playback_position_sync"],nXg=["offline/get_playback_data_entity"],Xy;Qq.getInstance=function(){return g.Z(function(l){return l.return(new Promise(function(y){g.Oo().then(function(r){r?(Qq.instance||(Qq.instance=new Qq(r)),y(Qq.instance)):y(void 0)})}))})};
Qq.prototype.get=function(l){var y=this,r,c,O;return g.Z(function(H){if(H.G==1)return g.h(H,zLx(y.token),2);if(H.G!=3)return r=H.K,g.h(H,r.get("prefs",l),3);c=H.K;if(!c)return H.return();O=(0,g.$$)();return c.expirationTimestampMs<=O?H.return():H.return(c.value)})};
Qq.prototype.set=function(l,y,r){r=r===void 0?31536E3:r;var c=this,O,H,V;return g.Z(function(T){if(T.G==1)return O=(0,g.$$)(),H={key:l,value:y,expirationTimestampMs:O+r*1E3},g.h(T,zLx(c.token),2);V=T.K;return g.h(T,g.XN(V,"prefs",H),0)})};
Qq.prototype.remove=function(l){var y=this,r;return g.Z(function(c){if(c.G==1)return g.h(c,zLx(y.token),2);r=c.K;return g.h(c,r.delete("prefs",l),0)})};
g.M(wS,g.Lr);g.M(Pe,yHs);Pe.prototype.N=function(l,y){y=cHz(y);l=(new TextEncoder).encode(JSON.stringify(l));return this.G.encrypt(l,y)};
Pe.prototype.K=function(l,y){if(!(l instanceof Uint8Array))throw kOb(1);var r=new TextDecoder;y=cHz(y);l=this.G.decrypt(l,y);return JSON.parse(r.decode(l))};
var OdJ={accountLinkStatusEntity:spH,booleanEntity:f1J,buttonEntity:ibH,captionTrack:sJQ,channelHandle:gUs,commerceAcquisitionClientPayloadEntity:QJI,commerceCartListEntity:wuj,contextNoteFeedEntityPayload:T9I,continuationTokenEntity:B9j,downloadQualityPickerEntity:qGH,downloadsPageRefreshTokenEntity:W6p,downloadsPageViewConfigurationEntity:xSH,downloadStatusEntity:Anz,dismissState:ZbQ,sfvAudioItemCurrentlyPlayingEntity:oZQ,emojiFountainDataEntity:D4g,emojiCustomizationSetEntity:tNz,fakeChannel:SGJ,
fakePlaylist:F6Q,fakePlaylistEntryCollection:EUJ,fakeVideo:uKg,fakeVideoDescription:M0J,featuredProductsEntity:jpg,flowStateEntity:a1H,iconBadgeEntity:P9H,interstitialInteractionStateEntity:I1g,likeButtonAnimationEntity:e7j,liveChatPollStateEntity:YGB,liveViewerLeaderboardChatEntryPointStateEntity:vZJ,liveViewerLeaderboardPointsEntity:JNj,liveReactionsDataEntity:d4Q,logoEntity:K6Q,macroMarkerEntity:nUI,mainDownloadsLibraryEntity:mSb,mainDownloadsListEntity:JnJ,mainPlaylistDownloadStateEntity:oUz,
mainPlaylistEntity:t0J,mainPlaylistVideoEntity:DSb,mainVideoDownloadStateEntity:h7B,mainVideoEntity:QpH,markersEngagementPanelSyncEntity:btJ,markersVisibilityOverrideEntity:R7H,musicAlbumReleaseDetail:VNx,musicAlbumReleaseDownloadMetadataEntity:yNH,musicAlbumRelease:HbJ,musicAlbumReleaseUserDetail:C9j,musicArtistDetail:TiB,musicArtist:gZs,musicArtistUserDetail:frg,musicDownloadsLibraryEntity:rNj,musicLibraryEdit:NiJ,musicLibraryStatusEntity:SKg,musicPlaylist:puz,musicPlaylistDownloadMetadataEntity:cNj,
musicShare:EZz,musicTrackDetail:MNb,musicTrackDownloadMetadataEntity:ObJ,musicTrack:ugJ,musicTrackUserDetail:arj,offlineOrchestrationActionWrapperEntity:KYj,offlineVideoPolicy:Irj,offlineVideoStreams:YKz,offlineabilityEntity:G$z,orchestrationWebSamplingEntity:Ztx,pageHeaderEntity:$4b,pdpStateEntity:x4z,pinnedProductEntity:L6J,playbackData:qKI,playerStateEntity:USQ,quantityIncrementerEntity:eLQ,refresh:ANg,saveToPlaylistListEntity:hLx,settingEntity:GOj,stringEntity:N9g,suggestedFeedbackChipStateEntity:z7H,
transfer:WYQ,trendingOfferEntity:lrB,videoDownloadContextEntity:m4x,videoOverviewAsyncDataEntity:nZQ,videoPlaybackPositionEntity:Xuz,votingEntity:Bis,ytMainChannelEntity:wXJ,youchatPendingResponseEntity:k$j,ytMainDownloadedVideoEntity:$Sg,ytMainVideoEntity:PAJ};g.M(UW,yHs);UW.prototype.N=function(l){return l};
UW.prototype.K=function(l){if(l instanceof Uint8Array)throw kOb(0);return l};
g.M(zt,g.X);zt.prototype.observe=function(l){var y=this;this.observers.push(l);return function(){var r=y.observers.indexOf(l);r>=0&&y.observers.splice(r,1)}};
zt.prototype.K=function(l){aEI(this,l.data)};
zt.prototype.yr=function(){this.channel.close()};
var qTJ,sKg=new g.GC("elementsCommand");var WV=new g.GC("entityBatchUpdate");var Cvj=new g.GC("downloadStatusEntity");var qrI=new g.GC("mainPlaylistEntityActionMetadata");var k6=new g.GC("mainVideoEntityActionMetadata");var ZoQ=new g.GC("musicPlaylistEntityActionMetadata");var ONH=new g.GC("musicTrackEntityActionMetadata");var iUp=new g.GC("localImageEntityActionMetadata");var Dj=new g.GC("playbackDataActionMetadata");var K$z=new g.GC("transferEntityActionMetadata");var HhI=new g.GC("videoPlaybackPositionEntityActionMetadata");var idp;new g.sy;new g.sy;x0g.prototype.request=function(l,y,r){y=y===void 0?{}:y;return this.locks.request(l,y,function(c){return r(c)})};var O$=g.QN.caches,cV,U0x;rI.prototype.open=function(l){return O$.open(bdz(l))};
rI.prototype.has=function(l){return O$.has(bdz(l))};
rI.prototype.delete=function(l){return O$.delete(bdz(l))};
rI.prototype.match=function(l,y){var r=this,c,O,H,V,T,f;return g.Z(function(N){switch(N.G){case 1:return g.h(N,r.keys(),2);case 2:c=N.K,O=g.a(c),H=O.next();case 3:if(H.done){N.Ez(5);break}V=H.value;return g.h(N,r.open(V),6);case 6:return T=N.K,g.h(N,T.match(l,y),7);case 7:if(f=N.K)return N.return(f);H=O.next();N.Ez(3);break;case 5:return N.return()}})};
g.M(nip,rI);nip.prototype.keys=function(){var l,y,r,c,O,H,V,T,f;return g.Z(function(N){if(N.G==1)return l=[],y=g.lz("CacheStorage keys"),g.h(N,O$.keys(),2);r=N.K;c=g.a(r);for(O=c.next();!O.done;O=c.next()){H=O.value;var S=H.indexOf(":");V=S===-1?{VR:H}:{VR:H.substring(0,S),datasyncId:H.substring(S+1)};T=V.VR;f=V.datasyncId;f===y&&l.push(T)}return N.return(l)})};g.M(VS,g.X);VS.prototype.N=function(l){this.api.HT("onOfflineOperationFailure",l.data)};
VS.prototype.B=function(l){this.api.publish("offlinetransferpause",l.data)};
VS.prototype.yr=function(){var l;(l=this.G)==null||l.close();var y;(y=this.K)==null||y.close()};jAJ.prototype.G$=function(){this.G&&gI(this)};
jAJ.prototype.PV=function(){this.K&&this.K.resolve();this.N=this.G=!1;this.X()};var DOb=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var uFB="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var vXz="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.M(zTz,$6);zTz.prototype.K=function(l){return S3(l)?LOH(this,l):FU(l)?r$j(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};g.M(c$p,$6);c$p.prototype.K=function(l){return FU(l)?Ohs(this,l):Vfg(l)?VLJ(this,l):pm(l)?CUB(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};g.C=glQ.prototype;g.C.WdC=function(l){var y=this,r,c,O,H;return g.Z(function(V){if(!g.b(l.state,128))return V.Ez(0);r=l.state.m3;var T=(c=r)==null?void 0:c.errorCode,f=(O=r)==null?void 0:O.kE;H=T==="net.connect"&&f===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(T==null?0:T.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return g.h(V,y.V_(y.player.getVideoData().videoId,H),0)})};
g.C.V_=function(l,y){var r=this;return g.Z(function(c){if(c.G==1){if(r.K)return c.return();r.K=!0;return y==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(XU(r,l,!1,!0),c.Ez(0)):g.h(c,iL(r,l),3)}g.i1(l,4);return g.h(c,r.G.V_(y),0)})};
g.C.K0=function(l){l.status===2?(l.status!==this.N&&(OUQ(this.G),g.i1(l.videoId,2)),l.Iy&&TDJ(this.G,l.videoId,l.Iy)):l.status===4?(iL(this,l.videoId),this.V_(l.videoId,l.zc?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):l.status===1&&ggJ(this.G);this.N=l.status;this.api.HT("localmediachange",{videoId:l.videoId,status:l.status})};
g.C.P1=function(){var l=this,y;return g.Z(function(r){if(r.G==1){if(l.K)return r.return();l.K=!0;y=l.player.getVideoData().videoId;return g.h(r,iL(l,y),2)}return g.h(r,l.G.P1(),0)})};
g.C.Is=function(l){switch(l){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.C.j=function(l){return this.api.D().j(l)};g.M(Elg,$6);Elg.prototype.K=function(l){return S3(l)?MLj(this,l):FU(l)?aZj(this,l):Vfg(l)?scz(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};W$z.prototype.G=function(l,y){var r=l.action.actionMetadata.priority-y.action.actionMetadata.priority;r===0&&(l.G<y.G?r=-1:l.G>y.G&&(r=1));return r};g.M(QS,g.X);QS.prototype.yr=function(){this.X&&this.X();g.X.prototype.yr.call(this)};
QS.prototype.createAction=function(l,y){var r=g.EX(l.entityKey).entityType,c=g.o1(16);return new s$(r,c,l,y.actionId,y.rootActionId)};
QS.prototype.i8=function(l){var y=this,r,c,O,H,V,T,f,N,S;return g.Z(function(F){if(F.G==1){if(y.Lq())return F.return();c=(r=l.offlineOrchestrationActionWrapperEntity)!=null?r:new Set;O=[];H=g.a(c);for(V=H.next();!V.done;V=H.next())T=V.value,f=g.EX(T),N=f.entityId,J$H(y.G,N)||O.push(T);return g.h(F,XGH(y,O),2)}S=F.K;return g.h(F,ihg(y,S),0)})};
QS.prototype.retry=function(){var l=this;return g.Z(function(y){return g.h(y,Qcj(l),0)})};PUg.prototype.WA=function(l,y){y=y===void 0?!0:y;var r=this,c,O,H,V,T,f,N,S;return g.Z(function(F){switch(F.G){case 1:if(!r.G)return F.return();c=[];O=g.TB(r.G.K,y);H=[];for(V={wg:0};V.wg<O.length;V={wg:V.wg},V.wg++)T=O[V.wg],f=r.G.bY(T,"json3"),N=g.th(f,{withCredentials:!0,format:"RAW"},3,500).then(function(p){return function(E){E={metadata:g.qL(O[p.wg]),trackData:E.xhr.responseText};H.push(E)}}(V)).v_(function(p){HV("Caption fetch error",p)}),c.push(N);
return g.h(F,CAj(c),2);case 2:return g.Im(F,3),g.h(F,Gmz(l,H),5);case 5:g.qJ(F,0);break;case 3:S=g.AW(F),HV("Caption DB transaction error",S),g.Kl(F)}})};g.M(wI,g.X);wI.prototype.yr=function(){this.K&&this.K();g.X.prototype.yr.call(this)};
wI.prototype.N=function(l){var y=this,r,c,O,H,V,T,f,N;return g.Z(function(S){c=(r=l.transfer)!=null?r:new Set;O=[];H=g.a(c);for(V=H.next();!V.done;V=H.next())T=V.value,f=g.EX(T),N=f.entityId,O.push(N);return O.length===0?S.return():g.h(S,nlJ(y,O),0)})};g.M(kTj,g.X);g.C=kTj.prototype;g.C.yr=function(){this.Nf&&this.Nf();this.Uz.dispose();this.B.dispose();this.Cq&&g.P7(this.L.Jz,this.Cq);this.II&&g.P7(this.L.Jz,this.II);g.X.prototype.yr.call(this)};
g.C.yQZ=function(l){var y=this,r,c,O;return g.Z(function(H){switch(H.G){case 1:r=g.uK(l,"transfer");if(y.G&&r===y.G.key){XU(y.J,y.C,!0);y.B.stop();H.Ez(0);break}return g.h(H,kp(y.K,{mode:"readwrite",L$:!0},function(V){return xp(V,r,"transfer").then(function(T){if(T&&T.transferState!=="TRANSFER_STATE_COMPLETE"&&T.transferState!=="TRANSFER_STATE_FAILED")return T.transferState="TRANSFER_STATE_PAUSED_BY_USER",bP(V,T,"transfer").then(function(){return T})})}),3);
case 3:c=H.K;if(!c){H.Ez(0);break}if(!l||!y.N){H.Ez(5);break}return g.h(H,E$(l,y.N,y.K,"DOWNLOAD_STATE_PAUSED"),5);case 5:return g.h(H,e3(y,l),7);case 7:O=H.K,Oog({videoId:l,On:c,offlineModeType:O}),g.Kl(H)}})};
g.C.OUw=function(){var l=this;if(this.G&&this.C){XU(this.J,this.C,!1);var y=this.G,r=(y==null?0:y.key)?g.EX(y.key).entityId:"";r&&this.N&&(new Promise(function(c,O){E$(r,l.N,l.K,"DOWNLOAD_STATE_PAUSED").catch(function(H){O(H)})})).catch(function(c){HV("Download state setting error",c)})}this.B.stop()};
g.C.Yb=function(){this.G?laJ(this,this.G):x6(this)};
g.C.EJ=function(l){var y=this;return g.Z(function(r){switch(r.G){case 1:if(!y.G){r.Ez(2);break}if(y.G.transferState==="TRANSFER_STATE_COMPLETE"||y.G.transferState==="TRANSFER_STATE_FAILED"||!l.transfer||!l.transfer.has(y.G.key)){r.Ez(3);break}return g.h(r,LB(y.K,y.G.key,"transfer"),4);case 4:y.G=r.K;if(y.G){r.Ez(3);break}return g.h(r,y4B(y),3);case 3:if(y.G)return r.return();case 2:return g.h(r,x6(y),0)}})};
g.C.V_=function(l,y){var r=this,c,O,H,V,T;return g.Z(function(f){switch(f.G){case 1:if(!r.G){nm(r,"onTransferFailure: "+l);f.Ez(2);break}c=r.G;H=((O=c)==null?0:O.key)?g.EX(c.key).entityId:"";a:switch(l){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var N=!1;break a;default:N=!0}return N&&fag(r)?g.h(f,bL(r,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):g.h(f,
NDJ(r,l),5);case 5:if(!H||!r.N){f.Ez(2);break}return g.h(f,E$(H,r.N,r.K,"DOWNLOAD_STATE_FAILED"),2);case 8:return g.h(f,e3(r,H),9);case 9:V=f.K;fm({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:H,On:c,offlineModeType:V});if(!H||!r.N){f.Ez(2);break}return g.h(f,E$(H,r.N,r.K,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:PV(r),T=x6(r,!0),y&&y(T),g.Kl(f)}})};
g.C.P1=function(l){var y=this,r,c,O,H,V,T,f,N,S,F,p,E;return g.Z(function(u){switch(u.G){case 1:if(!y.G){nm(y,"onMaybeTransferStreamsExpired");u.Ez(2);break}return fag(y)?g.h(u,bL(y,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):g.h(u,NDJ(y,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!y.N){u.Ez(2);break}r=y.G;O=((c=r)==null?0:c.key)?g.EX(r.key).entityId:"";if(!O){u.Ez(2);break}return g.h(u,E$(O,y.N,y.K,"DOWNLOAD_STATE_FAILED"),2);case 9:return y.G||nm(y,"onMaybeTransferStreamsExpiredRetryAttempting"),
H=y.G,T=((V=H)==null?0:V.key)?g.EX(H.key).entityId:"",g.h(u,e3(y,T),10);case 10:return f=u.K,fm({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:T,On:H,offlineModeType:f}),N=fNB(),g.Rn(N,Dj,{isEnqueuedForExpiredStreamUrlRefetch:!0}),S=g.uK(T,"playbackData"),F={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:S,actionMetadata:N},p=I6(new s$("playbackData",T,F)),g.h(u,jQ(y.K,p,"offlineOrchestrationActionWrapperEntity"),2);case 2:PV(y),E=x6(y,!0),
l&&l(E),g.Kl(u)}})};
var E1z={},SrJ=(E1z.TRANSFER_STATE_TRANSFERRING=1,E1z.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,E1z);g.C=R6.prototype;g.C.Fz=function(){return this.C.promise};
g.C.Gu=function(){if(this.K&&this.J)return this.C.promise;Egj(this).then(this.C.resolve).catch(this.C.reject);return this.C.promise};
g.C.Zb=function(l){var y={};return y.playbackData=new zTz(l,this.GD,this.G),y.transfer=new Elg(l,this.GD),y.videoPlaybackPositionEntity=new c$p(l,this.GD),y};
g.C.UV=function(){var l=this;return g.Z(function(y){return l.K?g.h(y,jcg(l.K),0):y.Ez(0)})};
g.C.KE=function(){var l=this,y,r;return g.Z(function(c){if(c.G==1)return l.K||l.J?g.h(c,l.Fz(),2):c.return();l.W!==void 0&&(g.qa(l.W),l.W=void 0);l.B!==void 0&&(g.qa(l.B),l.B=void 0);(y=l.K)==null||y.dispose();l.K=void 0;(r=l.J)==null||r.dispose();l.J=void 0;l.api.HT("onOrchestrationLostLeader");l.C=new g.sy;g.Kl(c)})};
g.C.isOrchestrationLeader=function(){return this.N.G};
g.C.KS=function(){return g.Z(function(l){return l.return(!1)})};
g.C.Wj=function(l){var y=this.G;y.api.publish("offlinetransferpause",l);var r;(r=y.K)==null||r.postMessage(l)};
g.C.Yb=function(l){var y,r;return g.Z(function(c){if(c.G==1)return g.h(c,yS(),2);y=c.K;if(!y)return c.return();r=g.uK(l,"transfer");return g.h(c,kp(y,{mode:"readwrite",L$:!0},function(O){var H=xp(O,r,"transfer"),V=xp(O,g.uK(l,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.o$.all([H,V]).then(function(T){T=g.a(T);var f=T.next().value;var N=T.next().value;return f&&f.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(f.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",bP(O,f,"transfer").then(function(){fm({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:l,On:f,offlineModeType:N==null?void 0:N.offlineModeType});return g.o$.resolve(null)})):g.o$.resolve(null)})}),0)})};
g.C.Pj=function(l){l=l===void 0?43200:l;var y=this,r,c,O,H,V,T,f,N;return g.Z(function(S){if(S.G==1)return y.L.kR()?g.h(S,yS(),2):S.return(ubg());if(S.G!=3){r=S.K;if(!r)return S.return([]);c=Date.now()/1E3;return g.h(S,lL(r,"offlineVideoPolicy"),3)}O=S.K;H=[];V=g.a(O);for(T=V.next();!T.done;T=V.next())f=T.value,Number(f.lastUpdatedTimestampSeconds)+l<=c&&(N=g.EX(f.key).entityId,H.push(N));return H.length?S.return(U$(y,H,y.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):S.return([])})};
g.C.deleteAll=function(){return U$(this,["!*$_ALL_ENTITIES_!*$"],this.X,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.C.refreshAllStaleEntities=function(l){var y=this;return g.Z(function(r){return r.G==1?g.h(r,y.Pj(l),2):r.return(r.K)})};
g.C.setUpPositionSyncInterval=function(l){var y=this;this.B!==void 0&&(g.qa(this.B),this.B=void 0);var r=l!=null?l:864E5;this.B=g.Iq(function(){y.qx(r)},r)};
g.C.qx=function(l){var y=this,r,c,O,H,V,T;return g.Z(function(f){switch(f.G){case 1:return g.Im(f,2),g.h(f,Qq.getInstance(),4);case 4:r=f.K;if(!r)throw Error("prefStorage is undefined");return g.h(f,r.get("psi"),5);case 5:c=f.K;H=((O=c)==null?0:O.wM)?Number(c.wM)/1E3:0;V=Date.now();if(!(H+l<=V)){f.Ez(6);break}return g.h(f,U$(y,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:g.qJ(f,0);break;case 2:T=g.AW(f),HV("Offline manager error",T),
g.Kl(f)}})};
g.C.dP=function(){var l=this,y,r,c,O,H,V,T;return g.Z(function(f){if(f.G==1)return g.h(f,yS(),2);if(f.G!=3)return(y=f.K)?g.h(f,lL(y,"transfer"),3):f.return([]);r=f.K;c=[];O=g.a(r);for(H=O.next();!H.done;H=O.next())V=H.value,V.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&V.key&&(T=g.EX(V.key).entityId,c.push(T));return f.return(aaj(l,c))})};
g.C.yC=function(){return g.Z(function(l){return l.return([])})};
g.C.Ac=function(){return g.Z(function(l){g.Kl(l)})};
g.C.Vw=function(){return g.Z(function(l){g.Kl(l)})};g.M(sVx,$6);sVx.prototype.K=function(l){return S3(l)?Yrs(this,l):FU(l)?A4j(this,l):pm(l)?W1g(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};
var z0=[10];g.M(hoj,$6);hoj.prototype.K=function(l){return S3(l)?$rJ(this,l):FU(l)?BDz(this,l):pm(l)?tyB(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};
var ZUs=[10];g.M(drJ,$6);drJ.prototype.K=function(l){return FU(l)?X6J(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};g.M(QVQ,R6);g.C=QVQ.prototype;g.C.Zb=function(l){var y=R6.prototype.Zb.call(this,l);y.mainVideoEntity=new hoj(l,this.GD,this.G);y.mainPlaylistEntity=new sVx(l,this.GD,this.G);y.mainDownloadsListEntity=new drJ(l,this.GD,this.G);return y};
g.C.refreshAllStaleEntities=function(l,y){var r=this,c,O,H,V,T,f,N,S,F,p,E;return g.Z(function(u){switch(u.G){case 1:c=[];if(!r.GD.j("web_player_offline_playlist_auto_refresh")){u.Ez(2);break}return g.h(u,w6p(r,l,y),3);case 3:c=u.K;case 2:return g.h(u,Qq.getInstance(),4);case 4:return O=u.K,g.h(u,(H=O)==null?void 0:H.get("sdois"),5);case 5:return V=u.K,g.h(u,(T=O)==null?void 0:T.get("lmqf"),6);case 6:f=u.K;if(!V){u.Ez(7);break}S=c;F=S.concat;return g.h(u,Paj(r,V,(N=f)!=null?N:"SD",l===0),8);case 8:c=
F.call(S,u.K);case 7:return p=c,E=p.concat,g.h(u,R6.prototype.refreshAllStaleEntities.call(r,l,y),9);case 9:return c=E.call(p,u.K),u.return(c)}})};
g.C.KS=function(l){var y,r,c,O,H,V,T,f;return g.Z(function(N){if(N.G==1)return g.h(N,yS(),2);if(N.G!=3)return(y=N.K)?g.h(N,LB(y,g.tu,"mainDownloadsListEntity"),3):N.return(!1);r=N.K;if((c=r)==null?0:(O=c.downloads)==null?0:O.length)for(H=g.uK(l,"mainVideoEntity"),V=g.a(r.downloads),T=V.next();!T.done;T=V.next())if(f=T.value,f.videoItem===H)return N.return(!0);return N.return(!1)})};
g.C.yC=function(){var l=this,y,r,c,O,H,V,T,f;return g.Z(function(N){if(N.G==1)return g.h(N,yS(),2);if(N.G!=3)return(y=N.K)?g.h(N,lL(y,"downloadStatusEntity"),3):N.return([]);r=N.K;c=[];O=g.a(r);for(H=O.next();!H.done;H=O.next())V=H.value,V.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&V.key&&(T=g.EX(V.key).entityId,c.push(T));return c.length?(f={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},N.return(U$(l,c,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
f))):N.return([])})};
g.C.Vw=function(){var l;return g.Z(function(y){return y.G==1?g.h(y,yS(),2):(l=y.K)?g.h(y,kp(l,{mode:"readwrite",L$:!0},function(r){return eQ(r,"mainVideoEntity").then(function(c){var O=[];c=g.a(c);for(var H=c.next();!H.done;H=c.next()){H=H.value;var V=void 0;(V=H.userState)!=null&&V.playbackPosition||(V=g.EX(H.key).entityId,V={key:g.uK(V,"videoPlaybackPositionEntity"),videoId:V,lastPlaybackPositionSeconds:"0"},O.push(bP(r,V,"videoPlaybackPositionEntity")),H.userState={playbackPosition:V.key},O.push(bP(r,
H,"mainVideoEntity")))}return g.o$.all(O)})}),0):y.return()})};
g.C.Ac=function(){var l,y,r,c,O,H,V,T,f,N,S,F,p,E,u,I,q,W,v,G,D,w,U,R,ON,Cl,ls,x,L,K,e,Xv,Ig,FQ,vz,jC,Hx,uj;return g.Z(function(A){if(A.G==1)return g.h(A,yS(),2);if(A.G!=3){l=A.K;if(!l)return A.return();y=g.uK("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return g.h(A,kp(l,{mode:"readonly",L$:!0},function(m){return g.o$.all([xp(m,y,"mainDownloadsListEntity"),xp(m,g.tu,"mainDownloadsListEntity"),eQ(m,"mainVideoEntity"),eQ(m,"mainPlaylistEntity")])}),3)}r=A.K;
c=g.a(r);O=c.next().value;H=c.next().value;V=c.next().value;T=c.next().value;f=O;N=H;S=V;F=T;p=new Set;if((E=f)==null?0:(u=E.downloads)==null?0:u.length)for(I=g.a(f.downloads),q=I.next();!q.done;q=I.next())W=q.value,v=void 0,(G=(v=W.videoItem)!=null?v:W.playlistItem)&&p.add(G);if((D=N)==null?0:(w=D.downloads)==null?0:w.length)for(U=g.a(N.downloads),R=U.next();!R.done;R=U.next())ON=R.value,ON.videoItem&&p.add(ON.videoItem);Cl=new Set;ls=[];x=g.a(F);for(L=x.next();!L.done;L=x.next()){K=L.value;if(K.videos)for(e=
g.a(K.videos),Xv=e.next();!Xv.done;Xv=e.next())Ig=Xv.value,(FQ=JSON.parse(g.EX(Ig).entityId).videoId)&&Cl.add(FQ);K.key&&!p.has(K.key)&&ls.push(K.key)}vz=g.a(S);for(jC=vz.next();!jC.done;jC=vz.next())Hx=jC.value,Hx.key&&!p.has(Hx.key)&&(uj=g.EX(Hx.key).entityId,Cl.has(uj)||ls.push(Hx.key));return ls.length?g.h(A,qmz(l,ls),0):A.Ez(0)})};g.M(xrp,$6);xrp.prototype.K=function(l){return S3(l)?ngQ(this,l):FU(l)?bUH(this,l):pm(l)?RoJ(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};
var j3=[10];g.M(zoH,$6);zoH.prototype.K=function(l){return S3(l)?jVJ(this,l):FU(l)?L1j(this,l):pm(l)?lvI(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};
var Lm=[10];g.M(c8J,$6);c8J.prototype.K=function(l){return S3(l)?Cog(this,l):FU(l)?g1J(this,l):pm(l)?Tfg(this,l):Promise.reject(Error("Unsupported action type: "+l.actionType))};
var VWj=[10];g.M(lR,R6);lR.prototype.Zb=function(l){var y=R6.prototype.Zb.call(this,l);y.musicTrack=new c8J(l,this.G);y.musicPlaylist=new zoH(l,this.G);y.musicAlbumRelease=new xrp(l,this.G);return y};
lR.prototype.refreshAllStaleEntities=function(l,y){var r=this,c,O,H;return g.Z(function(V){if(V.G==1)return g.h(V,Nfg(r,l,y),2);if(V.G!=3)return O=c=V.K,H=O.concat,g.h(V,R6.prototype.refreshAllStaleEntities.call(r,l,y),3);c=H.call(O,V.K);return V.return(c)})};g.M(SlJ,g.IG);g.C=SlJ.prototype;g.C.create=function(){var l=this;g.Q(this,this.events);g.O8(this.GD)?this.G=new QVQ(this.GD,this.player):g.bD(this.GD)&&(this.G=new lR(this.GD,this.player));this.events.S(this.player,"onPlaybackStartExternal",function(){l.JJ()});
this.events.S(this.player,"videodatachange",function(){l.JJ()});
this.GD.j("html5_offline_playback_position_sync")&&this.events.S(this.player,"presentingplayerstatechange",this.yH)};
g.C.bV=function(){return!1};
g.C.zN=function(l,y,r,c){var O=this;return g.Z(function(H){return O.G?H.return(U$(O.G,l,y,r,c)):H.return(Promise.reject())})};
g.C.deleteAll=function(){return this.G.deleteAll()};
g.C.Pj=function(l){return this.G.Pj(l)};
g.C.refreshAllStaleEntities=function(l){return this.G.refreshAllStaleEntities(l)};
g.C.setUpPositionSyncInterval=function(l){this.G.setUpPositionSyncInterval(l)};
g.C.Wj=function(l){this.G.Wj(l)};
g.C.Yb=function(l){return this.G.Yb(l)};
g.C.JJ=function(){var l=this,y;return g.Z(function(r){y=l.player.getVideoData();return g.Vb(y)?FRb(y)&&l.K!==y.clientPlaybackNonce?g.h(r,plb(l,y),0):r.Ez(0):r.return()})};
g.C.yH=function(l){var y=this,r,c,O,H,V,T,f;return g.Z(function(N){if(N.G==1)return r=y.player.getVideoData(),c=r.Sj,g.qm(l,2)||g.qm(l,512)?g.h(N,yS(),2):N.return();if(N.G!=3){O=N.K;if(!O)return HV("PES is undefined"),N.return();H=r.videoId;return g.h(N,LB(O,g.uK(H,"mainVideoEntity"),"mainVideoEntity"),3)}V=N.K;if(!V)return N.return();T=Math.floor(c).toString();f={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:T}};return g.h(N,y.zN([H],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
f),0)})};
g.C.isOrchestrationLeader=function(){return this.G.isOrchestrationLeader()};
g.C.updateDownloadState=function(l,y){var r,c,O,H;return g.Z(function(V){if(V.G==1)return g.h(V,yS(),2);r=V.K;if(!r)return HV("PES is undefined"),V.return();c=g.EX(l);O=c.entityType;H=c.entityId;return g.h(V,E$(H,O,r,y,!0),0)})};g.K8("offline",SlJ);})(_yt_player);
